import{_ as W,r as m,o as X,d as V,h as t,w as a,i as r,D as h,E as p,y as Y,G as Z,v as ee,j as c,s as le,x as P,m as s,t as v,e as A,F as q,B as O,C as te}from"./index-BTzqXMTB.js";const ae={class:"purchases-page"},oe={class:"card-header"},ue={__name:"Purchases",setup(re){const D=m([]),N=m([]),E=m([]),y=m(!1),_=m(!1),w=m(!1),o=m({productId:null,quantity:1,unitPrice:0,supplierId:null,warehouse:"",purchaseOrderNo:"",remarks:"",status:"PENDING"}),b=async()=>{y.value=!0;try{D.value=await h.getAll()}catch{p.error("加载采购列表失败")}finally{y.value=!1}},L=async()=>{try{N.value=await Y.getAll()}catch{p.error("加载产品列表失败")}},U=async()=>{try{E.value=await Z.getAll()}catch{p.error("加载供应商列表失败")}},B=async()=>{if(!o.value.productId||!o.value.supplierId){p.warning("请填写必填项");return}w.value=!0;try{const u=o.value.quantity*o.value.unitPrice;await h.create({product:{id:o.value.productId},quantity:o.value.quantity,unitPrice:o.value.unitPrice,totalAmount:u,supplier:{id:o.value.supplierId},warehouse:o.value.warehouse,purchaseOrderNo:o.value.purchaseOrderNo,remarks:o.value.remarks,status:o.value.status,purchaseDate:new Date().toISOString()}),p.success("创建成功"),_.value=!1,o.value={productId:null,quantity:1,unitPrice:0,supplierId:null,warehouse:"",purchaseOrderNo:"",remarks:"",status:"PENDING"},b()}catch{p.error("创建失败")}finally{w.value=!1}},T=u=>u?new Date(u).toLocaleString("zh-CN"):"-",S=u=>({PENDING:"warning",COMPLETED:"success",CANCELLED:"danger"})[u]||"info",G=u=>({PENDING:"待入库",COMPLETED:"已完成",CANCELLED:"已取消"})[u]||u,M=async u=>{try{await te.confirm(`确定要删除采购单 #${u.id} 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(u.id),p.success("删除成功"),b()}catch(l){l!=="cancel"&&p.error("删除失败")}};return X(()=>{b(),L(),U()}),(u,l)=>{const F=r("Plus"),$=r("el-icon"),f=r("el-button"),d=r("el-table-column"),z=r("el-tag"),j=r("el-table"),H=r("el-card"),I=r("el-option"),x=r("el-select"),i=r("el-form-item"),k=r("el-input-number"),g=r("el-input"),C=r("el-radio"),J=r("el-radio-group"),K=r("el-form"),Q=r("el-dialog"),R=ee("loading");return c(),V("div",ae,[t(H,{shadow:"hover"},{header:a(()=>[A("div",oe,[l[12]||(l[12]=A("span",null,"采购列表",-1)),t(f,{type:"primary",onClick:l[0]||(l[0]=e=>_.value=!0)},{default:a(()=>[t($,null,{default:a(()=>[t(F)]),_:1}),l[11]||(l[11]=s(" 创建采购单 ",-1))]),_:1})])]),default:a(()=>[le((c(),P(j,{data:D.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"采购单号",width:"100"}),t(d,{label:"产品",width:"180"},{default:a(({row:e})=>{var n;return[s(v(((n=e.product)==null?void 0:n.name)||"-"),1)]}),_:1}),t(d,{prop:"quantity",label:"数量",width:"100"}),t(d,{prop:"unitPrice",label:"单价",width:"120"},{default:a(({row:e})=>{var n;return[s(" ¥"+v(((n=e.unitPrice)==null?void 0:n.toFixed(2))||"0.00"),1)]}),_:1}),t(d,{prop:"totalAmount",label:"总额",width:"120"},{default:a(({row:e})=>{var n;return[s(" ¥"+v(((n=e.totalAmount)==null?void 0:n.toFixed(2))||"0.00"),1)]}),_:1}),t(d,{label:"供应商",width:"150"},{default:a(({row:e})=>{var n;return[s(v(((n=e.supplier)==null?void 0:n.name)||"-"),1)]}),_:1}),t(d,{prop:"purchaseDate",label:"采购日期",width:"180"},{default:a(({row:e})=>[s(v(T(e.purchaseDate)),1)]),_:1}),t(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:e})=>[t(z,{type:S(e.status)},{default:a(()=>[s(v(G(e.status)),1)]),_:2},1032,["type"])]),_:1}),t(d,{label:"操作",width:"100",fixed:"right"},{default:a(({row:e})=>[t(f,{type:"danger",size:"small",onClick:n=>M(e)},{default:a(()=>[...l[13]||(l[13]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,y.value]])]),_:1}),t(Q,{modelValue:_.value,"onUpdate:modelValue":l[10]||(l[10]=e=>_.value=e),title:"创建采购单",width:"600px"},{footer:a(()=>[t(f,{onClick:l[9]||(l[9]=e=>_.value=!1)},{default:a(()=>[...l[16]||(l[16]=[s("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:B,loading:w.value},{default:a(()=>[...l[17]||(l[17]=[s("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(K,{model:o.value,"label-width":"100px"},{default:a(()=>[t(i,{label:"产品",required:""},{default:a(()=>[t(x,{modelValue:o.value.productId,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.productId=e),placeholder:"请选择产品",style:{width:"100%"}},{default:a(()=>[(c(!0),V(q,null,O(N.value,e=>(c(),P(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"采购数量",required:""},{default:a(()=>[t(k,{modelValue:o.value.quantity,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.quantity=e),min:1,precision:2},null,8,["modelValue"])]),_:1}),t(i,{label:"单价",required:""},{default:a(()=>[t(k,{modelValue:o.value.unitPrice,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.unitPrice=e),precision:2,min:0},null,8,["modelValue"])]),_:1}),t(i,{label:"供应商",required:""},{default:a(()=>[t(x,{modelValue:o.value.supplierId,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.supplierId=e),placeholder:"请选择供应商",style:{width:"100%"}},{default:a(()=>[(c(!0),V(q,null,O(E.value,e=>(c(),P(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"仓库"},{default:a(()=>[t(g,{modelValue:o.value.warehouse,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.warehouse=e),placeholder:"请输入仓库位置"},null,8,["modelValue"])]),_:1}),t(i,{label:"采购单号"},{default:a(()=>[t(g,{modelValue:o.value.purchaseOrderNo,"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.purchaseOrderNo=e),placeholder:"请输入采购单号"},null,8,["modelValue"])]),_:1}),t(i,{label:"备注"},{default:a(()=>[t(g,{modelValue:o.value.remarks,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.remarks=e),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:a(()=>[t(J,{modelValue:o.value.status,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.status=e)},{default:a(()=>[t(C,{label:"PENDING"},{default:a(()=>[...l[14]||(l[14]=[s("待入库",-1)])]),_:1}),t(C,{label:"COMPLETED"},{default:a(()=>[...l[15]||(l[15]=[s("已完成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},se=W(ue,[["__scopeId","data-v-7f72f935"]]);export{se as default};
