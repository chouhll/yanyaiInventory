import{_ as E,d as l,e as s,f as h,s as U,T as q,F as m,B as v,t as o,U as _,j as i,A as z,V as j}from"./index-Dx6wz3Hl.js";const Q={name:"DataAnalytics",data(){return{activeTab:"sales",tabs:[{key:"sales",label:"销售趋势"},{key:"purchase",label:"采购趋势"},{key:"turnover",label:"库存周转"},{key:"dashboard",label:"经营看板"}],selectedPeriod:"month",groupBy:"day",dateRange:{startDate:null,endDate:null},loading:!1,salesTrend:[],purchaseTrend:[],turnoverAnalysis:[],businessDashboard:{}}},computed:{maxSalesAmount(){return!this.salesTrend||this.salesTrend.length===0?0:Math.max(...this.salesTrend.map(a=>parseFloat(a.amount||0)))},maxPurchaseAmount(){return!this.purchaseTrend||this.purchaseTrend.length===0?0:Math.max(...this.purchaseTrend.map(a=>parseFloat(a.amount||0)))},salesSummary(){if(!this.salesTrend||this.salesTrend.length===0)return{total:0,count:0,average:0};const a=this.salesTrend.reduce((c,e)=>c+parseFloat(e.amount||0),0),t=this.salesTrend.reduce((c,e)=>c+(e.count||0),0),d=t>0?a/t:0;return{total:a,count:t,average:d}},purchaseSummary(){if(!this.purchaseTrend||this.purchaseTrend.length===0)return{total:0,count:0,average:0};const a=this.purchaseTrend.reduce((c,e)=>c+parseFloat(e.amount||0),0),t=this.purchaseTrend.reduce((c,e)=>c+(e.count||0),0),d=t>0?a/t:0;return{total:a,count:t,average:d}}},mounted(){this.onPeriodChange()},methods:{onPeriodChange(){const a=new Date;let t,d=new Date;switch(this.selectedPeriod){case"week":t=new Date(a.getTime()-7*24*60*60*1e3),this.groupBy="day";break;case"month":t=new Date(a.getTime()-30*24*60*60*1e3),this.groupBy="day";break;case"quarter":t=new Date(a.getTime()-90*24*60*60*1e3),this.groupBy="week";break;case"year":t=new Date(a.getFullYear(),0,1),this.groupBy="month";break}this.dateRange.startDate=t.toISOString(),this.dateRange.endDate=d.toISOString(),this.loadAllData()},async loadAllData(){var a,t;this.loading=!0;try{await Promise.all([this.loadTrendData(),this.loadTurnoverAnalysis(),this.loadBusinessDashboard()])}catch(d){console.error("加载数据失败:",d),alert("加载数据失败: "+(((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.message)||d.message))}finally{this.loading=!1}},async loadTrendData(){const a={startDate:this.dateRange.startDate,endDate:this.dateRange.endDate,groupBy:this.groupBy},[t,d]=await Promise.all([_.get("/analytics/sales-trend",{params:a}),_.get("/analytics/purchase-trend",{params:a})]);this.salesTrend=t.data,this.purchaseTrend=d.data},async loadTurnoverAnalysis(){const a={startDate:this.dateRange.startDate,endDate:this.dateRange.endDate},t=await _.get("/analytics/inventory-turnover",{params:a});this.turnoverAnalysis=t.data},async loadBusinessDashboard(){const a={startDate:this.dateRange.startDate,endDate:this.dateRange.endDate},t=await _.get("/analytics/business-dashboard",{params:a});this.businessDashboard=t.data},getBarHeight(a,t){if(t===0)return 20;const e=parseFloat(a)/t*200;return Math.max(20,e)},formatAmount(a){return a?parseFloat(a).toFixed(2):"0.00"},formatPeriodLabel(a){return this.groupBy==="day"?a.substring(5):this.groupBy==="week"?a.substring(2):a.substring(5)},getRatingClass(a){return{优秀:"excellent",良好:"good",一般:"average",滞销:"poor"}[a]||""}}},Y={class:"data-analytics"},G={class:"controls"},J={class:"date-selector"},K={class:"tabs"},W=["onClick"],X={key:0,class:"tab-content"},Z={key:0,class:"loading"},$={key:1},ss={class:"chart-container"},ts={key:0,class:"chart"},es=["title"],as={class:"chart-label"},ns={class:"chart-value"},rs={key:1,class:"no-data"},os={class:"stats-summary"},ls={class:"stat-card"},is={class:"stat-value"},ds={class:"stat-card"},cs={class:"stat-value"},us={class:"stat-card"},hs={class:"stat-value"},ms={key:1,class:"tab-content"},vs={key:0,class:"loading"},_s={key:1},gs={class:"chart-container"},bs={key:0,class:"chart"},ys=["title"],ps={class:"chart-label"},Ds={class:"chart-value"},fs={key:1,class:"no-data"},ks={class:"stats-summary"},Ts={class:"stat-card"},As={class:"stat-value"},Ss={class:"stat-card"},ws={class:"stat-value"},Bs={class:"stat-card"},Ps={class:"stat-value"},Cs={key:2,class:"tab-content"},Ms={key:0,class:"loading"},Rs={key:1},xs={key:0,class:"no-data"},Fs={key:1,class:"analysis-table"},Hs={class:"product-name"},Vs={class:"number"},Is={class:"number"},Ls={class:"number highlight"},Os={class:"number"},Ns={key:3,class:"tab-content"},Us={key:0,class:"loading"},qs={key:1},zs={class:"dashboard-grid"},js={class:"dashboard-section"},Es={class:"metrics"},Qs={class:"metric-item"},Ys={class:"metric-value sales"},Gs={class:"metric-item"},Js={class:"metric-value"},Ks={class:"metric-item"},Ws={class:"metric-value"},Xs={class:"dashboard-section"},Zs={class:"metrics"},$s={class:"metric-item"},st={class:"metric-value purchase"},tt={class:"metric-item"},et={class:"metric-value"},at={class:"metric-item"},nt={class:"metric-value"},rt={class:"dashboard-section"},ot={class:"metrics"},lt={class:"metric-item"},it={class:"metric-value profit"},dt={class:"metric-item"},ct={class:"metric-value profit"},ut={class:"metric-item"},ht={class:"metric-value"},mt={class:"dashboard-section"},vt={class:"metrics"},_t={class:"metric-item"},gt={class:"metric-value"},bt={class:"metric-item"},yt={class:"metric-value warning"},pt={class:"metric-item"},Dt={class:"metric-value danger"};function ft(a,t,d,c,e,n){var g,b,y,p,D,f,k,T,A,S,w,B,P,C,M,R,x,F,H,V,I,L,O,N;return i(),l("div",Y,[t[33]||(t[33]=s("h1",null,"数据分析",-1)),s("div",G,[s("div",J,[U(s("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>e.selectedPeriod=r),onChange:t[1]||(t[1]=(...r)=>n.onPeriodChange&&n.onPeriodChange(...r))},[...t[4]||(t[4]=[s("option",{value:"week"},"最近一周",-1),s("option",{value:"month"},"最近一月",-1),s("option",{value:"quarter"},"最近三月",-1),s("option",{value:"year"},"本年度",-1)])],544),[[q,e.selectedPeriod]]),U(s("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>e.groupBy=r),onChange:t[3]||(t[3]=(...r)=>n.loadTrendData&&n.loadTrendData(...r))},[...t[5]||(t[5]=[s("option",{value:"day"},"按日",-1),s("option",{value:"week"},"按周",-1),s("option",{value:"month"},"按月",-1)])],544),[[q,e.groupBy]])])]),s("div",K,[(i(!0),l(m,null,v(e.tabs,r=>(i(),l("div",{key:r.key,onClick:u=>e.activeTab=r.key,class:z(["tab",{active:e.activeTab===r.key}])},o(r.label),11,W))),128))]),e.activeTab==="sales"?(i(),l("div",X,[e.loading?(i(),l("div",Z,"加载中...")):(i(),l("div",$,[t[9]||(t[9]=s("h2",null,"销售趋势分析",-1)),s("div",ss,[e.salesTrend&&e.salesTrend.length>0?(i(),l("div",ts,[(i(!0),l(m,null,v(e.salesTrend,(r,u)=>(i(),l("div",{key:u,class:"chart-bar-group"},[s("div",{class:"chart-bar sales",style:j({height:n.getBarHeight(r.amount,n.maxSalesAmount)+"px"}),title:`${r.period}: ¥${n.formatAmount(r.amount)}`},null,12,es),s("div",as,o(n.formatPeriodLabel(r.period)),1),s("div",ns,"¥"+o(n.formatAmount(r.amount)),1)]))),128))])):(i(),l("div",rs,"暂无数据"))]),s("div",os,[s("div",ls,[t[6]||(t[6]=s("div",{class:"stat-label"},"总销售额",-1)),s("div",is,"¥"+o(n.formatAmount(n.salesSummary.total)),1)]),s("div",ds,[t[7]||(t[7]=s("div",{class:"stat-label"},"订单数量",-1)),s("div",cs,o(n.salesSummary.count),1)]),s("div",us,[t[8]||(t[8]=s("div",{class:"stat-label"},"平均订单额",-1)),s("div",hs,"¥"+o(n.formatAmount(n.salesSummary.average)),1)])])]))])):h("",!0),e.activeTab==="purchase"?(i(),l("div",ms,[e.loading?(i(),l("div",vs,"加载中...")):(i(),l("div",_s,[t[13]||(t[13]=s("h2",null,"采购趋势分析",-1)),s("div",gs,[e.purchaseTrend&&e.purchaseTrend.length>0?(i(),l("div",bs,[(i(!0),l(m,null,v(e.purchaseTrend,(r,u)=>(i(),l("div",{key:u,class:"chart-bar-group"},[s("div",{class:"chart-bar purchase",style:j({height:n.getBarHeight(r.amount,n.maxPurchaseAmount)+"px"}),title:`${r.period}: ¥${n.formatAmount(r.amount)}`},null,12,ys),s("div",ps,o(n.formatPeriodLabel(r.period)),1),s("div",Ds,"¥"+o(n.formatAmount(r.amount)),1)]))),128))])):(i(),l("div",fs,"暂无数据"))]),s("div",ks,[s("div",Ts,[t[10]||(t[10]=s("div",{class:"stat-label"},"总采购额",-1)),s("div",As,"¥"+o(n.formatAmount(n.purchaseSummary.total)),1)]),s("div",Ss,[t[11]||(t[11]=s("div",{class:"stat-label"},"采购次数",-1)),s("div",ws,o(n.purchaseSummary.count),1)]),s("div",Bs,[t[12]||(t[12]=s("div",{class:"stat-label"},"平均采购额",-1)),s("div",Ps,"¥"+o(n.formatAmount(n.purchaseSummary.average)),1)])])]))])):h("",!0),e.activeTab==="turnover"?(i(),l("div",Cs,[e.loading?(i(),l("div",Ms,"加载中...")):(i(),l("div",Rs,[t[15]||(t[15]=s("h2",null,"库存周转率分析",-1)),!e.turnoverAnalysis||e.turnoverAnalysis.length===0?(i(),l("div",xs,"暂无数据")):(i(),l("table",Fs,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"产品编码"),s("th",null,"产品名称"),s("th",null,"分类"),s("th",null,"当前库存"),s("th",null,"销售数量"),s("th",null,"周转率"),s("th",null,"周转天数"),s("th",null,"评级")])],-1)),s("tbody",null,[(i(!0),l(m,null,v(e.turnoverAnalysis,r=>(i(),l("tr",{key:r.productId},[s("td",null,o(r.inventoryCode),1),s("td",Hs,o(r.productName),1),s("td",null,o(r.category||"-"),1),s("td",Vs,o(r.currentStock),1),s("td",Is,o(n.formatAmount(r.salesQuantity)),1),s("td",Ls,o(n.formatAmount(r.turnoverRate)),1),s("td",Os,o(n.formatAmount(r.turnoverDays)),1),s("td",null,[s("span",{class:z(["rating-badge",n.getRatingClass(r.turnoverRating)])},o(r.turnoverRating),3)])]))),128))])]))]))])):h("",!0),e.activeTab==="dashboard"?(i(),l("div",Ns,[e.loading?(i(),l("div",Us,"加载中...")):(i(),l("div",qs,[t[32]||(t[32]=s("h2",null,"经营分析看板",-1)),s("div",zs,[s("div",js,[t[19]||(t[19]=s("h3",null,"销售指标",-1)),s("div",Es,[s("div",Qs,[t[16]||(t[16]=s("span",{class:"metric-label"},"总销售额",-1)),s("span",Ys,"¥"+o(n.formatAmount((b=(g=e.businessDashboard)==null?void 0:g.salesMetrics)==null?void 0:b.totalSales)),1)]),s("div",Gs,[t[17]||(t[17]=s("span",{class:"metric-label"},"订单数量",-1)),s("span",Js,o(((p=(y=e.businessDashboard)==null?void 0:y.salesMetrics)==null?void 0:p.orderCount)||0),1)]),s("div",Ks,[t[18]||(t[18]=s("span",{class:"metric-label"},"平均订单值",-1)),s("span",Ws,"¥"+o(n.formatAmount((f=(D=e.businessDashboard)==null?void 0:D.salesMetrics)==null?void 0:f.averageOrderValue)),1)])])]),s("div",Xs,[t[23]||(t[23]=s("h3",null,"采购指标",-1)),s("div",Zs,[s("div",$s,[t[20]||(t[20]=s("span",{class:"metric-label"},"总采购额",-1)),s("span",st,"¥"+o(n.formatAmount((T=(k=e.businessDashboard)==null?void 0:k.purchaseMetrics)==null?void 0:T.totalPurchase)),1)]),s("div",tt,[t[21]||(t[21]=s("span",{class:"metric-label"},"采购次数",-1)),s("span",et,o(((S=(A=e.businessDashboard)==null?void 0:A.purchaseMetrics)==null?void 0:S.purchaseCount)||0),1)]),s("div",at,[t[22]||(t[22]=s("span",{class:"metric-label"},"平均采购值",-1)),s("span",nt,"¥"+o(n.formatAmount((B=(w=e.businessDashboard)==null?void 0:w.purchaseMetrics)==null?void 0:B.averagePurchaseValue)),1)])])]),s("div",rt,[t[27]||(t[27]=s("h3",null,"利润指标",-1)),s("div",ot,[s("div",lt,[t[24]||(t[24]=s("span",{class:"metric-label"},"毛利润",-1)),s("span",it,"¥"+o(n.formatAmount((C=(P=e.businessDashboard)==null?void 0:P.profitMetrics)==null?void 0:C.grossProfit)),1)]),s("div",dt,[t[25]||(t[25]=s("span",{class:"metric-label"},"毛利率",-1)),s("span",ct,o(n.formatAmount((R=(M=e.businessDashboard)==null?void 0:M.profitMetrics)==null?void 0:R.profitMargin))+"%",1)]),s("div",ut,[t[26]||(t[26]=s("span",{class:"metric-label"},"估算成本",-1)),s("span",ht,"¥"+o(n.formatAmount((F=(x=e.businessDashboard)==null?void 0:x.profitMetrics)==null?void 0:F.estimatedCost)),1)])])]),s("div",mt,[t[31]||(t[31]=s("h3",null,"库存指标",-1)),s("div",vt,[s("div",_t,[t[28]||(t[28]=s("span",{class:"metric-label"},"产品总数",-1)),s("span",gt,o(((V=(H=e.businessDashboard)==null?void 0:H.inventoryMetrics)==null?void 0:V.totalProducts)||0),1)]),s("div",bt,[t[29]||(t[29]=s("span",{class:"metric-label"},"低库存产品",-1)),s("span",yt,o(((L=(I=e.businessDashboard)==null?void 0:I.inventoryMetrics)==null?void 0:L.lowStockCount)||0),1)]),s("div",pt,[t[30]||(t[30]=s("span",{class:"metric-label"},"缺货产品",-1)),s("span",Dt,o(((N=(O=e.businessDashboard)==null?void 0:O.inventoryMetrics)==null?void 0:N.outOfStockCount)||0),1)])])])])]))])):h("",!0)])}const Tt=E(Q,[["render",ft],["__scopeId","data-v-39bb8cdd"]]);export{Tt as default};
