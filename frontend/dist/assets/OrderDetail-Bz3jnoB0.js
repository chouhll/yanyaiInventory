const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BTzqXMTB.js","assets/index-uDybftPD.css"])))=>i.map(i=>d[i]);
import{_ as et,r as D,K as te,o as tt,d as k,e as l,s as lt,h as t,w as a,i as u,x as A,f as E,v as at,H as le,b as st,E as m,u as ot,M as me,y as nt,I as it,j as p,m as c,t as i,F as ae,B as se,C as ke,J as dt}from"./index-BTzqXMTB.js";const ut={class:"order-detail-page"},rt={class:"page-header"},ct={class:"header-left"},vt={class:"header-info"},pt={class:"header-actions"},ft={class:"card-title"},mt={class:"status-actions"},_t={class:"card-title"},gt={class:"info-item"},bt={class:"info-value"},yt={class:"info-item"},wt={class:"info-value"},xt={class:"info-item"},ht={class:"info-value"},Ct={class:"info-item"},Dt={class:"info-value"},At={class:"card-title"},Tt={class:"product-cell"},kt={class:"product-name"},It={key:0,class:"product-spec"},Vt={class:"price-text"},Pt={class:"subtotal-text"},Nt={class:"order-summary"},Et={class:"summary-row"},Rt={class:"summary-value"},Ut={class:"summary-row total"},Ft={class:"summary-value total-amount"},Ot={class:"card-title"},zt={class:"contract-content"},St={class:"contract-header"},Lt={class:"contract-meta"},qt={class:"contract-section"},Mt={class:"contract-party"},$t={class:"contract-section"},Bt={class:"contract-party"},Ht={class:"info-row"},Wt={class:"info-value"},jt={class:"info-row"},Yt={class:"info-value"},Jt={class:"info-row"},Kt={class:"info-value"},Gt={class:"contract-section"},Qt={class:"contract-section"},Xt={class:"contract-total"},Zt={class:"total-value"},el={key:0,class:"contract-actions"},tl={key:1,class:"contract-actions"},ll={class:"card-title"},al={class:"info-item"},sl={class:"info-value"},ol={class:"info-item"},nl={class:"info-value"},il={class:"info-item"},dl={class:"info-value"},ul={class:"info-item"},rl={class:"info-value price-text"},cl={class:"info-item"},vl={class:"info-value"},pl={class:"info-item"},fl={class:"info-value total-amount"},ml={key:0,style:{"margin-top":"20px"}},_l={class:"items-container"},gl={class:"item-form-header"},bl={class:"item-number"},yl={class:"item-subtotal"},wl={class:"subtotal-value"},xl={class:"dialog-footer"},hl={key:1},Cl={class:"invoice-section"},Dl={class:"info-item"},Al={class:"info-value"},Tl={class:"info-item"},kl={class:"info-value"},Il={class:"info-item"},Vl={class:"info-value"},Pl={class:"info-item"},Nl={class:"info-value"},El={class:"info-item"},Rl={class:"info-value"},Ul={class:"invoice-calculation"},Fl={class:"calc-row"},Ol={class:"calc-value"},zl={class:"calc-row"},Sl={class:"calc-label"},Ll={class:"calc-value"},ql={class:"calc-row total"},Ml={class:"calc-value total-amount"},$l={class:"dialog-footer"},Bl={class:"invoice-pdf-preview"},Hl=["src"],Wl={key:1,class:"loading-preview"},jl={class:"dialog-footer"},Yl={class:"dialog-footer"},Jl={__name:"OrderDetail",setup(Kl){const Ie=st(),Ve=ot(),s=D({items:[],customer:{}}),Q=D([]),_e=D([]),oe=D(!1),H=D(!1),W=D(!1),g=D(!1),Pe=D(!1),j=D(""),T=D(null),Y=D(!1),J=D(!1),$=D(""),I=D({customerId:null,items:[]}),V=D({invoiceType:"NORMAL",taxRate:.13}),C=D({sellerName:"烟台智源供应链管理有限公司",sellerAddress:"山东省烟台市芝罘区",sellerPhone:"0535-1234567",deliveryDate:null,deliveryAddress:"",paymentMethod:"COD",specialTerms:""}),ne=[{value:"CREATED",label:"已创建"},{value:"CONTRACT_DRAFT",label:"合同拟定"},{value:"UNPAID",label:"未付款"},{value:"PAID",label:"已付款"},{value:"INVOICED",label:"已开票"},{value:"SHIPPED",label:"已发货"},{value:"COMPLETED",label:"已完成"}],ge=te(()=>{if(s.value.status==="CANCELLED")return-1;const n=ne.findIndex(e=>e.value===s.value.status);return n>=0?n:0}),S=te(()=>s.value.items?s.value.items.reduce((n,e)=>n+(e.subtotal||0),0):0),ie=te(()=>(S.value*V.value.taxRate).toFixed(2)),be=te(()=>(S.value+parseFloat(ie.value)).toFixed(2)),L=async()=>{oe.value=!0;try{s.value=await le.getById(Ie.params.id),j.value=s.value.status}catch{m.error("加载订单详情失败"),Ve.back()}finally{oe.value=!1}},Ne=async()=>{try{Q.value=await nt.getAll()}catch{m.error("加载产品列表失败")}},Ee=async()=>{try{_e.value=await it.getAll()}catch{m.error("加载客户列表失败")}},de=async()=>{if(s.value&&s.value.id)try{T.value=await me.getByOrder(s.value.id)}catch{T.value=null}},Re=()=>{var n;if(!((n=s.value.customer)!=null&&n.taxNumber)){m.warning("客户开票信息不完整，请先完善客户的税号等信息");return}Y.value=!0},Ue=n=>{const e=ne.findIndex(d=>d.value===n),f=ge.value;return s.value.status==="CANCELLED"?"error":e<f?"finish":e===f?"process":"wait"},ue=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",ye=n=>({CREATED:"info",CONTRACT_DRAFT:"warning",UNPAID:"warning",PAID:"success",INVOICED:"primary",SHIPPED:"",COMPLETED:"success",CANCELLED:"danger"})[n]||"info",we=n=>({CREATED:"已创建",CONTRACT_DRAFT:"合同拟定",UNPAID:"未付款",PAID:"已付款",INVOICED:"已开票",SHIPPED:"已发货",COMPLETED:"已完成",CANCELLED:"已取消"})[n]||n,Fe=()=>{var n;I.value={customerId:(n=s.value.customer)==null?void 0:n.id,items:s.value.items.map(e=>{var f;return{productId:(f=e.product)==null?void 0:f.id,quantity:e.quantity,unitPrice:e.unitPrice,costUnitPrice:e.costUnitPrice||e.unitPrice}})},H.value=!0},Oe=n=>{const e=Q.value.find(f=>f.id===n.productId);e&&(n.unitPrice=e.price||0,n.costUnitPrice=e.price||0)},ze=()=>{I.value.items.push({productId:null,quantity:1,unitPrice:0,costUnitPrice:0})},Se=n=>{I.value.items.splice(n,1)},Le=async()=>{var e,f;if(!I.value.customerId){m.warning("请选择客户");return}if(I.value.items.some(d=>!d.productId||d.quantity<=0)){m.warning("请完整填写所有订单项");return}g.value=!0;try{const d={id:s.value.id,customer:{id:I.value.customerId},status:s.value.status,items:I.value.items.map(r=>{const v=Q.value.find(q=>q.id===r.productId);return{product:{id:r.productId},quantity:r.quantity,unitPrice:r.unitPrice||(v==null?void 0:v.price)||0,costUnitPrice:r.costUnitPrice||(v==null?void 0:v.price)||0,subtotal:r.quantity*(r.unitPrice||(v==null?void 0:v.price)||0),costSubtotal:r.quantity*(r.costUnitPrice||(v==null?void 0:v.price)||0)}})};await le.update(s.value.id,d),m.success("订单更新成功"),H.value=!1,L()}catch(d){m.error("更新失败: "+(((f=(e=d.response)==null?void 0:e.data)==null?void 0:f.message)||d.message))}finally{g.value=!1}},qe=async()=>{if(!j.value){m.warning("请选择新状态");return}g.value=!0;try{await le.updateStatus(s.value.id,j.value),m.success("状态更新成功"),W.value=!1,L()}catch{m.error("状态更新失败")}finally{g.value=!1}},Me=()=>{var U,X,P,K,F,O,x;const n="INV-"+new Date().getFullYear()+String(new Date().getMonth()+1).padStart(2,"0")+String(new Date().getDate()).padStart(2,"0")+"-"+Math.random().toString(36).substr(2,4).toUpperCase(),e=new Date().toLocaleDateString("zh-CN"),f=V.value.invoiceType==="SPECIAL"?"专用":"普通",d=((U=s.value.customer)==null?void 0:U.companyName)||((X=s.value.customer)==null?void 0:X.name)||"",r=((P=s.value.customer)==null?void 0:P.taxNumber)||"",v=((K=s.value.customer)==null?void 0:K.companyAddress)||"",q=(((F=s.value.customer)==null?void 0:F.bankName)||"")+" "+(((O=s.value.customer)==null?void 0:O.bankAccount)||""),R=s.value.orderNumber,re=S.value.toFixed(2),ce=(V.value.taxRate*100).toFixed(0),ve=ie.value,pe=be.value,M=((x=s.value.items)==null?void 0:x.map(N=>{var Z,_,z,B;return"<tr><td>"+(((Z=N.product)==null?void 0:Z.name)||"")+"</td><td>"+(((_=N.product)==null?void 0:_.specification)||"-")+'</td><td class="amount">'+N.quantity+'</td><td class="amount">¥'+((z=N.unitPrice)==null?void 0:z.toFixed(2))+'</td><td class="amount">¥'+((B=N.subtotal)==null?void 0:B.toFixed(2))+"</td></tr>"}).join(""))||"",fe=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <style>
        body { font-family: 'SimSun', serif; padding: 40px; background: #f5f5f5; }
        .invoice { background: white; border: 2px solid #000; padding: 40px; max-width: 900px; margin: 0 auto; }
        .header { text-align: center; font-size: 28px; font-weight: bold; margin-bottom: 30px; color: #333; }
        .invoice-no { text-align: right; color: #d32f2f; margin-bottom: 25px; font-size: 16px; }
        .section { margin: 25px 0; }
        .section-title { font-weight: bold; background: #f0f0f0; padding: 10px 15px; margin: 15px 0; border-left: 4px solid #1976d2; }
        .info-row { margin: 12px 0; line-height: 1.8; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #f5f5f5; font-weight: 600; }
        .amount { text-align: right; }
        .total-row { font-weight: bold; background: #fafafa; }
        .highlight-row { font-size: 18px; background: #fff3e0; }
        .highlight-row td:last-child { color: #d32f2f; font-size: 20px; font-weight: 700; }
        .footer { margin-top: 40px; }
        .note-text { min-height: 60px; color: #666; }
        .stamp { text-align: right; margin-top: 50px; color: #666; }
        .stamp-text { margin-top: 30px; font-size: 14px; }
        .stamp-notice { margin-top: 50px; color: #999; }
      </style>
    </head>
    <body>
      <div class="invoice">
        <div class="header">增值税`+f+`发票</div>
        <div class="invoice-no">发票号码：`+n+`</div>
        
        <div class="section">
          <div class="section-title">购买方信息</div>
          <div class="info-row"><strong>名称：</strong>`+d+`</div>
          <div class="info-row"><strong>纳税人识别号：</strong>`+r+`</div>
          <div class="info-row"><strong>地址、电话：</strong>`+v+`</div>
          <div class="info-row"><strong>开户行及账号：</strong>`+q+`</div>
        </div>
        
        <div class="section">
          <div class="section-title">订单明细</div>
          <div class="info-row"><strong>订单号：</strong>`+R+`</div>
          <div class="info-row"><strong>开票日期：</strong>`+e+`</div>
          
          <table>
            <thead>
              <tr>
                <th>货物或应税劳务名称</th>
                <th>规格型号</th>
                <th class="amount">数量</th>
                <th class="amount">单价</th>
                <th class="amount">金额</th>
              </tr>
            </thead>
            <tbody>
              `+M+`
              <tr class="total-row">
                <td colspan="4">合计金额</td>
                <td class="amount">¥`+re+`</td>
              </tr>
              <tr class="total-row">
                <td colspan="4">税率 `+ce+`%</td>
                <td class="amount">¥`+ve+`</td>
              </tr>
              <tr class="total-row highlight-row">
                <td colspan="4">价税合计（大写）</td>
                <td class="amount">¥`+pe+`</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="footer">
          <div class="section-title">备注</div>
          <p class="note-text">本发票由系统生成，仅供预览使用。</p>
          <div class="stamp">
            <p class="stamp-text">销售方（公章）</p>
            <p class="stamp-notice">[此为系统生成的模拟发票]</p>
          </div>
        </div>
      </div>
    </body>
    </html>
  `,b=new Blob([fe],{type:"text/html"});return URL.createObjectURL(b)},$e=()=>{var n;if(!((n=s.value.customer)!=null&&n.taxNumber)){m.warning("客户开票信息不完整");return}$.value=Me(),Y.value=!1,J.value=!0},Be=async()=>{var n,e;g.value=!0;try{const f={orderId:s.value.id,invoiceType:V.value.invoiceType,taxRate:V.value.taxRate};await me.issue(f),m.success("发票开具成功"),J.value=!1,$.value&&(URL.revokeObjectURL($.value),$.value=""),await L(),await de()}catch(f){const d=((e=(n=f.response)==null?void 0:n.data)==null?void 0:e.message)||f.message||"开票失败";m.error(d)}finally{g.value=!1}},He=()=>["CONTRACT_DRAFT","UNPAID","PAID","INVOICED","SHIPPED","COMPLETED"].includes(s.value.status),xe=async()=>{if(!C.value.sellerName){m.warning("请填写卖方公司名称");return}g.value=!0;try{m.success("合同保存成功"),await L()}catch(n){m.error("保存失败: "+(n.message||"未知错误"))}finally{g.value=!1}},We=async()=>{try{await ke.confirm('确认合同后将更新订单状态为"已付款"，是否继续？',"确认合同",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),g.value=!0,await xe(),await le.updateStatus(s.value.id,"PAID"),m.success('合同已确认，订单状态已更新为"已付款"'),await L()}catch(n){n!=="cancel"&&m.error("确认失败: "+(n.message||"未知错误"))}finally{g.value=!1}},he=async n=>{try{const{contractApi:e}=await dt(async()=>{const{contractApi:q}=await import("./index-BTzqXMTB.js").then(R=>R.W);return{contractApi:q}},__vite__mapDeps([0,1]));let f;n==="word"?f=await e.downloadWord(s.value.id):f=await e.downloadPdf(s.value.id);const d=await f.blob(),r=window.URL.createObjectURL(d),v=document.createElement("a");v.href=r,v.download=`contract_${s.value.orderNumber||s.value.id}.${n==="word"?"docx":"pdf"}`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(r),m.success(`合同${n==="word"?"Word":"PDF"}下载成功`)}catch(e){m.error("下载失败: "+(e.message||"未知错误"))}},je=async()=>{try{const n=await ke.prompt("请输入作废原因","作废发票",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入作废原因"});g.value=!0,await me.void(T.value.id,n.value),m.success("发票已作废"),await L(),await de()}catch(n){n!=="cancel"&&m.error("作废失败")}finally{g.value=!1}};return tt(async()=>{await L(),await de(),Ne(),Ee(),s.value.customer&&(C.value.deliveryAddress=s.value.customer.address||"")}),(n,e)=>{const f=u("ArrowLeft"),d=u("el-icon"),r=u("el-button"),v=u("el-tag"),q=u("Edit"),R=u("Document"),re=u("Histogram"),ce=u("el-step"),ve=u("el-steps"),pe=u("Refresh"),M=u("el-card"),fe=u("InfoFilled"),b=u("el-col"),U=u("el-row"),X=u("ShoppingCart"),P=u("el-table-column"),K=u("el-table"),F=u("el-divider"),O=u("el-input"),x=u("el-form-item"),N=u("el-form"),Z=u("el-date-picker"),_=u("el-option"),z=u("el-select"),B=u("Check"),Ye=u("CircleCheck"),Ce=u("Download"),Je=u("Close"),Ke=u("Delete"),De=u("el-input-number"),Ge=u("Plus"),ee=u("el-dialog"),Qe=u("el-alert"),Ae=u("el-radio"),Xe=u("el-radio-group"),Ze=at("loading");return p(),k("div",ut,[l("div",rt,[l("div",ct,[t(r,{onClick:e[0]||(e[0]=o=>n.$router.back()),size:"large",plain:""},{default:a(()=>[t(d,null,{default:a(()=>[t(f)]),_:1}),e[23]||(e[23]=c(" 返回 ",-1))]),_:1}),l("div",vt,[e[24]||(e[24]=l("h2",{class:"page-title"},"订单详情",-1)),t(v,{type:ye(s.value.status),size:"large",effect:"dark"},{default:a(()=>[c(i(we(s.value.status)),1)]),_:1},8,["type"])])]),l("div",pt,[Pe.value?E("",!0):(p(),A(r,{key:0,type:"primary",onClick:Fe,size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t(q)]),_:1}),e[25]||(e[25]=c(" 编辑订单 ",-1))]),_:1})),s.value.status==="PAID"&&!T.value?(p(),A(r,{key:1,type:"warning",onClick:Re,size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t(R)]),_:1}),e[26]||(e[26]=c(" 开具发票 ",-1))]),_:1})):E("",!0)])]),lt((p(),A(U,{gutter:20},{default:a(()=>[t(b,{span:24},{default:a(()=>[t(M,{shadow:"hover",class:"status-card"},{header:a(()=>[l("div",ft,[t(d,null,{default:a(()=>[t(re)]),_:1}),e[27]||(e[27]=l("span",null,"订单状态流程",-1))])]),default:a(()=>[t(ve,{active:ge.value,"finish-status":"success","align-center":""},{default:a(()=>[(p(),k(ae,null,se(ne,o=>t(ce,{key:o.value,title:o.label,status:Ue(o.value)},null,8,["title","status"])),64))]),_:1},8,["active"]),l("div",mt,[t(r,{type:"primary",onClick:e[1]||(e[1]=o=>W.value=!0),size:"default"},{default:a(()=>[t(d,null,{default:a(()=>[t(pe)]),_:1}),e[28]||(e[28]=c(" 更新状态 ",-1))]),_:1})])]),_:1}),t(M,{shadow:"hover",class:"info-card"},{header:a(()=>[l("div",_t,[t(d,null,{default:a(()=>[t(fe)]),_:1}),e[29]||(e[29]=l("span",null,"基本信息",-1))])]),default:a(()=>[t(U,{gutter:20},{default:a(()=>[t(b,{span:12},{default:a(()=>[l("div",gt,[e[30]||(e[30]=l("span",{class:"info-label"},"订单号:",-1)),l("span",bt,i(s.value.orderNumber||"-"),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",yt,[e[31]||(e[31]=l("span",{class:"info-label"},"订单ID:",-1)),l("span",wt,"#"+i(s.value.id),1)])]),_:1}),t(b,{span:12},{default:a(()=>{var o;return[l("div",xt,[e[32]||(e[32]=l("span",{class:"info-label"},"客户:",-1)),l("span",ht,i(((o=s.value.customer)==null?void 0:o.name)||"-"),1)])]}),_:1}),t(b,{span:12},{default:a(()=>[l("div",Ct,[e[33]||(e[33]=l("span",{class:"info-label"},"订单日期:",-1)),l("span",Dt,i(ue(s.value.orderDate)),1)])]),_:1})]),_:1})]),_:1}),t(M,{shadow:"hover",class:"items-card"},{header:a(()=>[l("div",At,[t(d,null,{default:a(()=>[t(X)]),_:1}),e[34]||(e[34]=l("span",null,"订单商品",-1))])]),default:a(()=>[t(K,{data:s.value.items,border:"","header-cell-style":{background:"#f5f7fa",fontWeight:"600"}},{default:a(()=>[t(P,{label:"产品名称","min-width":"180"},{default:a(({row:o})=>{var y,h;return[l("div",Tt,[l("span",kt,i(((y=o.product)==null?void 0:y.name)||"-"),1),(h=o.product)!=null&&h.specification?(p(),k("span",It,i(o.product.specification),1)):E("",!0)])]}),_:1}),t(P,{prop:"quantity",label:"数量",width:"100",align:"center"},{default:a(({row:o})=>[t(v,{type:"info",size:"large"},{default:a(()=>[c(i(o.quantity),1)]),_:2},1024)]),_:1}),t(P,{label:"单价",width:"120",align:"right"},{default:a(({row:o})=>{var y;return[l("span",Vt,"¥"+i(((y=o.unitPrice)==null?void 0:y.toFixed(2))||"0.00"),1)]}),_:1}),t(P,{label:"小计",width:"140",align:"right"},{default:a(({row:o})=>{var y;return[l("span",Pt,"¥"+i(((y=o.subtotal)==null?void 0:y.toFixed(2))||"0.00"),1)]}),_:1})]),_:1},8,["data"]),l("div",Nt,[l("div",Et,[e[35]||(e[35]=l("span",{class:"summary-label"},"商品总额:",-1)),l("span",Rt,"¥"+i(S.value.toFixed(2)),1)]),t(F,{style:{margin:"12px 0"}}),l("div",Ut,[e[36]||(e[36]=l("span",{class:"summary-label"},"订单总计:",-1)),l("span",Ft,"¥"+i(S.value.toFixed(2)),1)])])]),_:1}),s.value.status==="CONTRACT_DRAFT"||He()?(p(),A(M,{key:0,shadow:"hover",class:"contract-card"},{header:a(()=>[l("div",Ot,[t(d,null,{default:a(()=>[t(R)]),_:1}),e[39]||(e[39]=l("span",null,"合同管理",-1)),s.value.status==="CONTRACT_DRAFT"?(p(),A(v,{key:0,type:"warning",effect:"dark",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[37]||(e[37]=[c(" 待确认 ",-1)])]),_:1})):(p(),A(v,{key:1,type:"success",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[38]||(e[38]=[c(" 已确认 ",-1)])]),_:1}))])]),default:a(()=>{var o,y,h,Te;return[l("div",zt,[l("div",St,[e[40]||(e[40]=l("h3",{class:"contract-title"},"销售合同",-1)),l("div",Lt,[l("span",null,"合同编号: "+i(s.value.orderNumber||`#${s.value.id}`),1),l("span",null,"签订日期: "+i(ue(s.value.orderDate)),1)])]),l("div",qt,[e[41]||(e[41]=l("h4",{class:"section-title"},"甲方（卖方）",-1)),l("div",Mt,[t(N,{"label-width":"100px",size:"default"},{default:a(()=>[t(x,{label:"公司名称:"},{default:a(()=>[t(O,{modelValue:C.value.sellerName,"onUpdate:modelValue":e[2]||(e[2]=w=>C.value.sellerName=w),disabled:s.value.status!=="CONTRACT_DRAFT",placeholder:"请输入公司名称"},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"联系地址:"},{default:a(()=>[t(O,{modelValue:C.value.sellerAddress,"onUpdate:modelValue":e[3]||(e[3]=w=>C.value.sellerAddress=w),disabled:s.value.status!=="CONTRACT_DRAFT",placeholder:"请输入联系地址"},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"联系电话:"},{default:a(()=>[t(O,{modelValue:C.value.sellerPhone,"onUpdate:modelValue":e[4]||(e[4]=w=>C.value.sellerPhone=w),disabled:s.value.status!=="CONTRACT_DRAFT",placeholder:"请输入联系电话"},null,8,["modelValue","disabled"])]),_:1})]),_:1})])]),l("div",$t,[e[45]||(e[45]=l("h4",{class:"section-title"},"乙方（买方）",-1)),l("div",Bt,[l("div",Ht,[e[42]||(e[42]=l("span",{class:"info-label"},"公司名称:",-1)),l("span",Wt,i(((o=s.value.customer)==null?void 0:o.companyName)||((y=s.value.customer)==null?void 0:y.name)||"-"),1)]),l("div",jt,[e[43]||(e[43]=l("span",{class:"info-label"},"联系地址:",-1)),l("span",Yt,i(((h=s.value.customer)==null?void 0:h.address)||"-"),1)]),l("div",Jt,[e[44]||(e[44]=l("span",{class:"info-label"},"联系电话:",-1)),l("span",Kt,i(((Te=s.value.customer)==null?void 0:Te.phone)||"-"),1)])])]),l("div",Gt,[e[46]||(e[46]=l("h4",{class:"section-title"},"合同条款",-1)),t(N,{"label-width":"120px",size:"default"},{default:a(()=>[t(x,{label:"交货日期:"},{default:a(()=>[t(Z,{modelValue:C.value.deliveryDate,"onUpdate:modelValue":e[5]||(e[5]=w=>C.value.deliveryDate=w),disabled:s.value.status!=="CONTRACT_DRAFT",type:"date",placeholder:"选择交货日期",style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"交货地点:"},{default:a(()=>[t(O,{modelValue:C.value.deliveryAddress,"onUpdate:modelValue":e[6]||(e[6]=w=>C.value.deliveryAddress=w),disabled:s.value.status!=="CONTRACT_DRAFT",placeholder:"请输入交货地点"},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"付款方式:"},{default:a(()=>[t(z,{modelValue:C.value.paymentMethod,"onUpdate:modelValue":e[7]||(e[7]=w=>C.value.paymentMethod=w),disabled:s.value.status!=="CONTRACT_DRAFT",placeholder:"选择付款方式",style:{width:"100%"}},{default:a(()=>[t(_,{label:"货到付款",value:"COD"}),t(_,{label:"预付全款",value:"PREPAID"}),t(_,{label:"分期付款",value:"INSTALLMENT"}),t(_,{label:"账期付款",value:"CREDIT"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(x,{label:"特殊条款:"},{default:a(()=>[t(O,{modelValue:C.value.specialTerms,"onUpdate:modelValue":e[8]||(e[8]=w=>C.value.specialTerms=w),disabled:s.value.status!=="CONTRACT_DRAFT",type:"textarea",rows:4,placeholder:"请输入特殊条款或备注"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),l("div",Qt,[e[48]||(e[48]=l("h4",{class:"section-title"},"合同商品明细",-1)),t(K,{data:s.value.items,border:"","header-cell-style":{background:"#f5f7fa",fontWeight:"600"}},{default:a(()=>[t(P,{label:"商品名称",prop:"product.name","min-width":"180"}),t(P,{label:"数量",prop:"quantity",width:"100",align:"center"}),t(P,{label:"单价",width:"120",align:"right"},{default:a(({row:w})=>{var G;return[c(" ¥"+i((G=w.unitPrice)==null?void 0:G.toFixed(2)),1)]}),_:1}),t(P,{label:"小计",width:"140",align:"right"},{default:a(({row:w})=>{var G;return[c(" ¥"+i((G=w.subtotal)==null?void 0:G.toFixed(2)),1)]}),_:1})]),_:1},8,["data"]),l("div",Xt,[e[47]||(e[47]=l("span",{class:"total-label"},"合同总额:",-1)),l("span",Zt,"¥"+i(S.value.toFixed(2)),1)])])]),s.value.status==="CONTRACT_DRAFT"?(p(),k("div",el,[t(r,{type:"primary",size:"large",onClick:xe,loading:g.value},{default:a(()=>[t(d,null,{default:a(()=>[t(B)]),_:1}),e[49]||(e[49]=c(" 保存合同 ",-1))]),_:1},8,["loading"]),t(r,{type:"success",size:"large",onClick:We,loading:g.value},{default:a(()=>[t(d,null,{default:a(()=>[t(Ye)]),_:1}),e[50]||(e[50]=c(" 确认合同并付款 ",-1))]),_:1},8,["loading"])])):(p(),k("div",tl,[t(r,{type:"primary",size:"large",onClick:e[9]||(e[9]=w=>he("word"))},{default:a(()=>[t(d,null,{default:a(()=>[t(Ce)]),_:1}),e[51]||(e[51]=c(" 下载Word合同 ",-1))]),_:1}),t(r,{type:"warning",size:"large",onClick:e[10]||(e[10]=w=>he("pdf"))},{default:a(()=>[t(d,null,{default:a(()=>[t(Ce)]),_:1}),e[52]||(e[52]=c(" 下载PDF合同 ",-1))]),_:1})]))]}),_:1})):E("",!0),T.value?(p(),A(M,{key:1,shadow:"hover",class:"invoice-card"},{header:a(()=>[l("div",ll,[t(d,null,{default:a(()=>[t(R)]),_:1}),e[55]||(e[55]=l("span",null,"发票信息",-1)),T.value.status==="ISSUED"?(p(),A(v,{key:0,type:"success",effect:"dark",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[53]||(e[53]=[c(" 已开具 ",-1)])]),_:1})):T.value.status==="VOIDED"?(p(),A(v,{key:1,type:"info",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[54]||(e[54]=[c(" 已作废 ",-1)])]),_:1})):E("",!0)])]),default:a(()=>[t(U,{gutter:20},{default:a(()=>[t(b,{span:12},{default:a(()=>[l("div",al,[e[56]||(e[56]=l("span",{class:"info-label"},"发票号码:",-1)),l("span",sl,i(T.value.invoiceNumber),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",ol,[e[57]||(e[57]=l("span",{class:"info-label"},"开票日期:",-1)),l("span",nl,i(ue(T.value.invoiceDate)),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",il,[e[58]||(e[58]=l("span",{class:"info-label"},"发票类型:",-1)),l("span",dl,i(T.value.invoiceType==="NORMAL"?"普通发票":"专用发票"),1)])]),_:1}),t(b,{span:12},{default:a(()=>{var o;return[l("div",ul,[e[59]||(e[59]=l("span",{class:"info-label"},"总金额:",-1)),l("span",rl,"¥"+i(((o=T.value.totalAmount)==null?void 0:o.toFixed(2))||"0.00"),1)])]}),_:1}),t(b,{span:12},{default:a(()=>{var o;return[l("div",cl,[e[60]||(e[60]=l("span",{class:"info-label"},"税额:",-1)),l("span",vl,"¥"+i(((o=T.value.taxAmount)==null?void 0:o.toFixed(2))||"0.00"),1)])]}),_:1}),t(b,{span:12},{default:a(()=>{var o;return[l("div",pl,[e[61]||(e[61]=l("span",{class:"info-label"},"价税合计:",-1)),l("span",fl,"¥"+i(((o=T.value.amountWithTax)==null?void 0:o.toFixed(2))||"0.00"),1)])]}),_:1})]),_:1}),T.value.status==="ISSUED"?(p(),k("div",ml,[t(r,{type:"danger",size:"default",onClick:je},{default:a(()=>[t(d,null,{default:a(()=>[t(Je)]),_:1}),e[62]||(e[62]=c(" 作废发票 ",-1))]),_:1})])):E("",!0)]),_:1})):E("",!0)]),_:1})]),_:1})),[[Ze,oe.value]]),t(ee,{modelValue:H.value,"onUpdate:modelValue":e[13]||(e[13]=o=>H.value=o),title:"编辑订单",width:"750px","close-on-click-modal":!1},{footer:a(()=>[l("div",xl,[t(r,{onClick:e[12]||(e[12]=o=>H.value=!1),size:"large"},{default:a(()=>[...e[67]||(e[67]=[c("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Le,loading:g.value,size:"large"},{default:a(()=>[...e[68]||(e[68]=[c(" 保存更改 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(N,{model:I.value,"label-width":"90px",class:"order-form"},{default:a(()=>[t(x,{label:"选择客户",required:""},{default:a(()=>[t(z,{modelValue:I.value.customerId,"onUpdate:modelValue":e[11]||(e[11]=o=>I.value.customerId=o),placeholder:"请选择客户",size:"large",filterable:"",style:{width:"100%"}},{default:a(()=>[(p(!0),k(ae,null,se(_e.value,o=>(p(),A(_,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(F,{"content-position":"left"},{default:a(()=>[...e[63]||(e[63]=[c("订单商品",-1)])]),_:1}),l("div",_l,[(p(!0),k(ae,null,se(I.value.items,(o,y)=>(p(),k("div",{key:y,class:"item-form-card"},[l("div",gl,[l("span",bl,"商品 "+i(y+1),1),I.value.items.length>1?(p(),A(r,{key:0,type:"danger",size:"small",text:"",onClick:h=>Se(y)},{default:a(()=>[t(d,null,{default:a(()=>[t(Ke)]),_:1}),e[64]||(e[64]=c(" 移除 ",-1))]),_:1},8,["onClick"])):E("",!0)]),t(x,{label:"选择产品",required:""},{default:a(()=>[t(z,{modelValue:o.productId,"onUpdate:modelValue":h=>o.productId=h,placeholder:"搜索并选择产品",filterable:"",style:{width:"100%"},onChange:h=>Oe(o)},{default:a(()=>[(p(!0),k(ae,null,se(Q.value,h=>(p(),A(_,{key:h.id,label:`${h.name} (库存: ${h.stock||0})`,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),t(U,{gutter:20},{default:a(()=>[t(b,{span:12},{default:a(()=>[t(x,{label:"数量",required:""},{default:a(()=>[t(De,{modelValue:o.quantity,"onUpdate:modelValue":h=>o.quantity=h,min:.01,precision:2,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(b,{span:12},{default:a(()=>[t(x,{label:"单价",required:""},{default:a(()=>[t(De,{modelValue:o.unitPrice,"onUpdate:modelValue":h=>o.unitPrice=h,precision:2,min:0,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l("div",yl,[e[65]||(e[65]=l("span",{class:"subtotal-label"},"小计:",-1)),l("span",wl,"¥"+i(((o.quantity||0)*(o.unitPrice||0)).toFixed(2)),1)])]))),128))]),t(r,{type:"primary",plain:"",onClick:ze,class:"add-item-btn",size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t(Ge)]),_:1}),e[66]||(e[66]=c(" 添加更多商品 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(ee,{modelValue:Y.value,"onUpdate:modelValue":e[17]||(e[17]=o=>Y.value=o),title:"开具发票",width:"650px","close-on-click-modal":!1},{footer:a(()=>{var o;return[l("div",$l,[t(r,{onClick:e[16]||(e[16]=y=>Y.value=!1),size:"large"},{default:a(()=>[...e[79]||(e[79]=[c("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:$e,loading:g.value,disabled:!((o=s.value.customer)!=null&&o.taxNumber),size:"large"},{default:a(()=>[g.value?E("",!0):(p(),A(d,{key:0},{default:a(()=>[t(B)]),_:1})),e[80]||(e[80]=c(" 确认开票 ",-1))]),_:1},8,["loading","disabled"])])]}),default:a(()=>{var o;return[(o=s.value.customer)!=null&&o.taxNumber?(p(),k("div",hl,[l("div",Cl,[e[74]||(e[74]=l("h4",{class:"section-title"},"客户开票信息",-1)),t(U,{gutter:16,class:"invoice-info"},{default:a(()=>[t(b,{span:12},{default:a(()=>[l("div",Dl,[e[69]||(e[69]=l("span",{class:"info-label"},"公司抬头:",-1)),l("span",Al,i(s.value.customer.companyName||"-"),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",Tl,[e[70]||(e[70]=l("span",{class:"info-label"},"税号:",-1)),l("span",kl,i(s.value.customer.taxNumber||"-"),1)])]),_:1}),t(b,{span:24},{default:a(()=>[l("div",Il,[e[71]||(e[71]=l("span",{class:"info-label"},"公司地址:",-1)),l("span",Vl,i(s.value.customer.companyAddress||"-"),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",Pl,[e[72]||(e[72]=l("span",{class:"info-label"},"开户银行:",-1)),l("span",Nl,i(s.value.customer.bankName||"-"),1)])]),_:1}),t(b,{span:12},{default:a(()=>[l("div",El,[e[73]||(e[73]=l("span",{class:"info-label"},"银行账号:",-1)),l("span",Rl,i(s.value.customer.bankAccount||"-"),1)])]),_:1})]),_:1})]),t(F),t(N,{model:V.value,"label-width":"90px"},{default:a(()=>[t(x,{label:"发票类型",required:""},{default:a(()=>[t(Xe,{modelValue:V.value.invoiceType,"onUpdate:modelValue":e[14]||(e[14]=y=>V.value.invoiceType=y),size:"large"},{default:a(()=>[t(Ae,{label:"NORMAL"},{default:a(()=>[...e[75]||(e[75]=[c("普通发票",-1)])]),_:1}),t(Ae,{label:"SPECIAL"},{default:a(()=>[...e[76]||(e[76]=[c("专用发票",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"税率",required:""},{default:a(()=>[t(z,{modelValue:V.value.taxRate,"onUpdate:modelValue":e[15]||(e[15]=y=>V.value.taxRate=y),size:"large",style:{width:"200px"}},{default:a(()=>[t(_,{label:"13%",value:.13}),t(_,{label:"9%",value:.09}),t(_,{label:"6%",value:.06}),t(_,{label:"3%",value:.03})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(F),l("div",Ul,[l("div",Fl,[e[77]||(e[77]=l("span",{class:"calc-label"},"订单金额:",-1)),l("span",Ol,"¥"+i(S.value.toFixed(2)),1)]),l("div",zl,[l("span",Sl,"税额 ("+i((V.value.taxRate*100).toFixed(0))+"%):",1),l("span",Ll,"¥"+i(ie.value),1)]),t(F,{style:{margin:"12px 0"}}),l("div",ql,[e[78]||(e[78]=l("span",{class:"calc-label"},"价税合计:",-1)),l("span",Ml,"¥"+i(be.value),1)])])])):(p(),A(Qe,{key:0,title:"客户开票信息不完整",type:"warning",description:"请先到客户管理页面完善该客户的税号等开票信息",closable:!1,style:{"margin-bottom":"20px"}}))]}),_:1},8,["modelValue"]),t(ee,{modelValue:J.value,"onUpdate:modelValue":e[19]||(e[19]=o=>J.value=o),title:"发票预览",width:"900px","close-on-click-modal":!1},{footer:a(()=>[l("div",jl,[t(r,{onClick:e[18]||(e[18]=o=>J.value=!1),size:"large"},{default:a(()=>[...e[82]||(e[82]=[c("关闭",-1)])]),_:1}),t(r,{type:"primary",onClick:Be,loading:g.value,size:"large"},{default:a(()=>[g.value?E("",!0):(p(),A(d,{key:0},{default:a(()=>[t(B)]),_:1})),e[83]||(e[83]=c(" 确认开具 ",-1))]),_:1},8,["loading"])])]),default:a(()=>[l("div",Bl,[$.value?(p(),k("iframe",{key:0,src:$.value,style:{width:"100%",height:"700px",border:"1px solid #ddd","border-radius":"4px"}},null,8,Hl)):(p(),k("div",Wl,[t(d,{style:{"font-size":"48px",color:"#909399"}},{default:a(()=>[t(R)]),_:1}),e[81]||(e[81]=l("p",{style:{"margin-top":"20px",color:"#909399"}},"生成发票中...",-1))]))])]),_:1},8,["modelValue"]),t(ee,{modelValue:W.value,"onUpdate:modelValue":e[22]||(e[22]=o=>W.value=o),title:"更新订单状态",width:"450px","close-on-click-modal":!1},{footer:a(()=>[l("div",Yl,[t(r,{onClick:e[21]||(e[21]=o=>W.value=!1),size:"large"},{default:a(()=>[...e[84]||(e[84]=[c("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:qe,loading:g.value,size:"large"},{default:a(()=>[...e[85]||(e[85]=[c(" 确认更新 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(N,{"label-width":"90px"},{default:a(()=>[t(x,{label:"当前状态"},{default:a(()=>[t(v,{type:ye(s.value.status),size:"large",effect:"dark"},{default:a(()=>[c(i(we(s.value.status)),1)]),_:1},8,["type"])]),_:1}),t(x,{label:"新状态",required:""},{default:a(()=>[t(z,{modelValue:j.value,"onUpdate:modelValue":e[20]||(e[20]=o=>j.value=o),placeholder:"请选择新状态",size:"large",style:{width:"100%"}},{default:a(()=>[t(_,{label:"已创建",value:"CREATED"}),t(_,{label:"合同拟定",value:"CONTRACT_DRAFT"}),t(_,{label:"未付款",value:"UNPAID"}),t(_,{label:"付款完成",value:"PAID"}),t(_,{label:"已开票",value:"INVOICED"}),t(_,{label:"已发货",value:"SHIPPED"}),t(_,{label:"已完成",value:"COMPLETED"}),t(_,{label:"已取消",value:"CANCELLED"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ql=et(Jl,[["__scopeId","data-v-9c112eb3"]]);export{Ql as default};
