import{_ as be,r as b,o as Ce,d as D,e as o,h as t,w as l,i as n,H as S,E as v,y as De,I as Ie,v as Pe,j as m,m as i,s as ke,x as w,f as $,t as r,F as N,B as T,C as he}from"./index-C-qTPntZ.js";const we={class:"orders-page"},Ve={class:"page-header"},Ee={class:"customer-info"},Ue={class:"order-items"},xe={class:"item-name"},ze={class:"item-detail"},Ae={key:0,class:"more-items"},qe={class:"amount-cell"},Se={class:"amount-value"},$e={class:"date-info"},Ne={class:"action-buttons"},Te={style:{float:"right",color:"#8492a6","font-size":"13px"}},Le={class:"items-container"},Oe={class:"item-form-header"},Be={class:"item-number"},Fe={class:"product-option"},Me={class:"product-name"},He={class:"product-info"},Re={class:"product-price"},je={class:"item-subtotal"},We={class:"subtotal-value"},Ge={class:"order-total"},Je={class:"total-value"},Ke={class:"dialog-footer"},Qe={class:"dialog-footer"},Xe={__name:"Orders",setup(Ye){const L=b([]),x=b([]),F=b([]),z=b(!1),V=b(!1),E=b(!1),I=b(!1),A=b(null),U=b(""),f=b({customerId:null,items:[{productId:null,quantity:1,unitPrice:0,costUnitPrice:0}]}),q=async()=>{z.value=!0;try{L.value=await S.getAll()}catch{v.error("加载订单列表失败")}finally{z.value=!1}},Q=async()=>{try{x.value=await De.getAll()}catch{v.error("加载产品列表失败")}},X=async()=>{try{F.value=await Ie.getAll()}catch{v.error("加载客户列表失败")}},Y=s=>!s||s.length===0?0:s.reduce((e,y)=>e+(y.subtotal||0),0),Z=()=>f.value.items.reduce((s,e)=>s+(e.quantity||0)*(e.unitPrice||0),0),ee=()=>{f.value.items.push({productId:null,quantity:1,unitPrice:0,costUnitPrice:0})},te=s=>{f.value.items.splice(s,1)},le=(s,e)=>{const y=x.value.find(d=>d.id===s.productId);y&&(s.unitPrice=y.price||0,s.costUnitPrice=y.price||0)},ae=async()=>{var e,y;if(!f.value.customerId){v.warning("请选择客户");return}if(f.value.items.some(d=>!d.productId||d.quantity<=0)){v.warning("请完整填写所有订单项");return}I.value=!0;try{const d={customer:{id:f.value.customerId},orderDate:new Date().toISOString(),items:f.value.items.map(u=>{const _=x.value.find(O=>O.id===u.productId);return{product:{id:u.productId},quantity:u.quantity,unitPrice:u.unitPrice||(_==null?void 0:_.price)||0,costUnitPrice:u.costUnitPrice||(_==null?void 0:_.price)||0,subtotal:u.quantity*(u.unitPrice||(_==null?void 0:_.price)||0),costSubtotal:u.quantity*(u.costUnitPrice||(_==null?void 0:_.price)||0)}})};await S.create(d),v.success("订单创建成功"),V.value=!1,f.value={customerId:null,items:[{productId:null,quantity:1,unitPrice:0,costUnitPrice:0}]},q()}catch(d){v.error("创建失败: "+(((y=(e=d.response)==null?void 0:e.data)==null?void 0:y.message)||d.message))}finally{I.value=!1}},se=s=>{A.value=s,U.value=s.status,E.value=!0},oe=async()=>{if(!U.value){v.warning("请选择新状态");return}I.value=!0;try{await S.updateStatus(A.value.id,U.value),v.success("状态更新成功"),E.value=!1,q()}catch{v.error("状态更新失败")}finally{I.value=!1}},ne=async s=>{try{await he.confirm(`确定要删除订单 ${s.orderNumber||"#"+s.id} 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await S.delete(s.id),v.success("订单删除成功"),q()}catch(e){e!=="cancel"&&v.error("删除失败")}},ie=s=>{if(!s)return"-";const e=new Date(s);return`${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`},M=s=>({CREATED:"info",UNPAID:"warning",PAID:"success",INVOICED:"primary",SHIPPED:"",COMPLETED:"success",CANCELLED:"danger"})[s]||"info",H=s=>({CREATED:"已创建",UNPAID:"未付款",PAID:"已付款",INVOICED:"已开票",SHIPPED:"已发货",COMPLETED:"已完成",CANCELLED:"已取消"})[s]||s;return Ce(()=>{q(),Q(),X()}),(s,e)=>{const y=n("Plus"),d=n("el-icon"),u=n("el-button"),_=n("DocumentCopy"),O=n("el-link"),P=n("el-table-column"),ue=n("User"),de=n("Calendar"),g=n("el-tag"),re=n("el-table"),ce=n("el-empty"),pe=n("el-card"),C=n("el-option"),B=n("el-select"),h=n("el-form-item"),_e=n("List"),me=n("el-divider"),fe=n("Delete"),R=n("el-input-number"),j=n("el-col"),ve=n("el-row"),W=n("el-form"),ye=n("Check"),G=n("el-dialog"),ge=Pe("loading");return m(),D("div",we,[o("div",Ve,[e[8]||(e[8]=o("div",{class:"header-content"},[o("h2",{class:"page-title"},"订单管理"),o("p",{class:"page-subtitle"},"管理和跟踪所有订单")],-1)),t(u,{type:"primary",size:"large",onClick:e[0]||(e[0]=a=>V.value=!0)},{default:l(()=>[t(d,null,{default:l(()=>[t(y)]),_:1}),e[7]||(e[7]=i(" 创建订单 ",-1))]),_:1})]),t(pe,{shadow:"hover",class:"main-card"},{default:l(()=>[ke((m(),w(re,{data:L.value,stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"}},{default:l(()=>[t(P,{label:"订单号",width:"160",fixed:"left"},{default:l(({row:a})=>[t(O,{type:"primary",onClick:p=>s.$router.push(`/orders/${a.id}`),underline:!1,class:"order-link"},{default:l(()=>[t(d,null,{default:l(()=>[t(_)]),_:1}),i(" "+r(a.orderNumber||`#${a.id}`),1)]),_:2},1032,["onClick"])]),_:1}),t(P,{label:"客户",width:"150"},{default:l(({row:a})=>{var p;return[o("div",Ee,[t(d,{class:"info-icon"},{default:l(()=>[t(ue)]),_:1}),o("span",null,r(((p=a.customer)==null?void 0:p.name)||"-"),1)])]}),_:1}),t(P,{label:"订单明细","min-width":"280"},{default:l(({row:a})=>{var p,c;return[o("div",Ue,[(m(!0),D(N,null,T((p=a.items)==null?void 0:p.slice(0,2),(k,Ze)=>{var J,K;return m(),D("div",{key:k.id,class:"item-row"},[o("span",xe,r((J=k.product)==null?void 0:J.name),1),o("span",ze," × "+r(k.quantity)+" | ¥"+r((K=k.unitPrice)==null?void 0:K.toFixed(2)),1)])}),128)),((c=a.items)==null?void 0:c.length)>2?(m(),D("div",Ae," +"+r(a.items.length-2)+" 更多商品 ",1)):$("",!0)])]}),_:1}),t(P,{label:"订单金额",width:"130",align:"right"},{default:l(({row:a})=>[o("div",qe,[o("span",Se,"¥"+r(Y(a.items).toFixed(2)),1)])]),_:1}),t(P,{label:"订单日期",width:"160"},{default:l(({row:a})=>[o("div",$e,[t(d,{class:"info-icon"},{default:l(()=>[t(de)]),_:1}),o("span",null,r(ie(a.orderDate)),1)])]),_:1}),t(P,{label:"状态",width:"110",align:"center"},{default:l(({row:a})=>[t(g,{type:M(a.status),effect:"dark",size:"default"},{default:l(()=>[i(r(H(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(P,{label:"操作",width:"180",fixed:"right",align:"center"},{default:l(({row:a})=>[o("div",Ne,[t(u,{type:"primary",size:"small",onClick:p=>se(a),plain:""},{default:l(()=>[...e[9]||(e[9]=[i(" 更新状态 ",-1)])]),_:1},8,["onClick"]),t(u,{type:"danger",size:"small",onClick:p=>ne(a),plain:""},{default:l(()=>[...e[10]||(e[10]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ge,z.value]]),!z.value&&L.value.length===0?(m(),w(ce,{key:0,description:"暂无订单数据","image-size":120})):$("",!0)]),_:1}),t(G,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),title:"创建新订单",width:"750px","close-on-click-modal":!1},{footer:l(()=>[o("div",Ke,[t(u,{onClick:e[2]||(e[2]=a=>V.value=!1),size:"large"},{default:l(()=>[...e[16]||(e[16]=[i("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:ae,loading:I.value,size:"large"},{default:l(()=>[I.value?$("",!0):(m(),w(d,{key:0},{default:l(()=>[t(ye)]),_:1})),e[17]||(e[17]=i(" 确认创建 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[t(W,{model:f.value,"label-width":"90px",class:"order-form"},{default:l(()=>[t(h,{label:"选择客户",required:""},{default:l(()=>[t(B,{modelValue:f.value.customerId,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value.customerId=a),placeholder:"请选择客户",size:"large",filterable:"",style:{width:"100%"}},{default:l(()=>[(m(!0),D(N,null,T(F.value,a=>(m(),w(C,{key:a.id,label:a.name,value:a.id},{default:l(()=>[o("span",null,r(a.name),1),o("span",Te,r(a.phone||"-"),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(me,{"content-position":"left"},{default:l(()=>[t(d,null,{default:l(()=>[t(_e)]),_:1}),e[11]||(e[11]=i(" 订单商品 ",-1))]),_:1}),o("div",Le,[(m(!0),D(N,null,T(f.value.items,(a,p)=>(m(),D("div",{key:p,class:"item-form-card"},[o("div",Oe,[o("span",Be,"商品 "+r(p+1),1),f.value.items.length>1?(m(),w(u,{key:0,type:"danger",size:"small",text:"",onClick:c=>te(p)},{default:l(()=>[t(d,null,{default:l(()=>[t(fe)]),_:1}),e[12]||(e[12]=i(" 移除 ",-1))]),_:1},8,["onClick"])):$("",!0)]),t(h,{label:"选择产品",required:""},{default:l(()=>[t(B,{modelValue:a.productId,"onUpdate:modelValue":c=>a.productId=c,placeholder:"搜索并选择产品",filterable:"",style:{width:"100%"},onChange:c=>le(a,p)},{default:l(()=>[(m(!0),D(N,null,T(x.value,c=>(m(),w(C,{key:c.id,label:c.name,value:c.id},{default:l(()=>{var k;return[o("div",Fe,[o("span",Me,r(c.name),1),o("span",He,[t(g,{size:"small",type:"info"},{default:l(()=>[i("库存: "+r(c.stock||0),1)]),_:2},1024),o("span",Re,"¥"+r((k=c.price)==null?void 0:k.toFixed(2)),1)])])]}),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),t(ve,{gutter:20},{default:l(()=>[t(j,{span:12},{default:l(()=>[t(h,{label:"数量",required:""},{default:l(()=>[t(R,{modelValue:a.quantity,"onUpdate:modelValue":c=>a.quantity=c,min:.01,precision:2,step:1,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(j,{span:12},{default:l(()=>[t(h,{label:"单价",required:""},{default:l(()=>[t(R,{modelValue:a.unitPrice,"onUpdate:modelValue":c=>a.unitPrice=c,precision:2,min:0,step:.01,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o("div",je,[e[13]||(e[13]=o("span",{class:"subtotal-label"},"小计:",-1)),o("span",We,"¥"+r(((a.quantity||0)*(a.unitPrice||0)).toFixed(2)),1)])]))),128))]),t(u,{type:"primary",plain:"",onClick:ee,class:"add-item-btn",size:"large"},{default:l(()=>[t(d,null,{default:l(()=>[t(y)]),_:1}),e[14]||(e[14]=i(" 添加更多商品 ",-1))]),_:1}),o("div",Ge,[e[15]||(e[15]=o("span",{class:"total-label"},"订单总额:",-1)),o("span",Je,"¥"+r(Z().toFixed(2)),1)])]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(G,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=a=>E.value=a),title:"更新订单状态",width:"450px","close-on-click-modal":!1},{footer:l(()=>[o("div",Qe,[t(u,{onClick:e[5]||(e[5]=a=>E.value=!1),size:"large"},{default:l(()=>[...e[25]||(e[25]=[i("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:oe,loading:I.value,size:"large"},{default:l(()=>[...e[26]||(e[26]=[i(" 确认更新 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[t(W,{"label-width":"90px"},{default:l(()=>[t(h,{label:"当前状态"},{default:l(()=>{var a;return[t(g,{type:M((a=A.value)==null?void 0:a.status),size:"large",effect:"dark"},{default:l(()=>{var p;return[i(r(H((p=A.value)==null?void 0:p.status)),1)]}),_:1},8,["type"])]}),_:1}),t(h,{label:"新状态",required:""},{default:l(()=>[t(B,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=a=>U.value=a),placeholder:"请选择新状态",size:"large",style:{width:"100%"}},{default:l(()=>[t(C,{label:"已创建",value:"CREATED"},{default:l(()=>[t(g,{type:"info",size:"small"},{default:l(()=>[...e[18]||(e[18]=[i("已创建",-1)])]),_:1})]),_:1}),t(C,{label:"未付款",value:"UNPAID"},{default:l(()=>[t(g,{type:"warning",size:"small"},{default:l(()=>[...e[19]||(e[19]=[i("未付款",-1)])]),_:1})]),_:1}),t(C,{label:"付款完成",value:"PAID"},{default:l(()=>[t(g,{type:"success",size:"small"},{default:l(()=>[...e[20]||(e[20]=[i("付款完成",-1)])]),_:1})]),_:1}),t(C,{label:"已开票",value:"INVOICED"},{default:l(()=>[t(g,{type:"primary",size:"small"},{default:l(()=>[...e[21]||(e[21]=[i("已开票",-1)])]),_:1})]),_:1}),t(C,{label:"已发货",value:"SHIPPED"},{default:l(()=>[t(g,{size:"small"},{default:l(()=>[...e[22]||(e[22]=[i("已发货",-1)])]),_:1})]),_:1}),t(C,{label:"已完成",value:"COMPLETED"},{default:l(()=>[t(g,{type:"success",size:"small"},{default:l(()=>[...e[23]||(e[23]=[i("已完成",-1)])]),_:1})]),_:1}),t(C,{label:"已取消",value:"CANCELLED"},{default:l(()=>[t(g,{type:"danger",size:"small"},{default:l(()=>[...e[24]||(e[24]=[i("已取消",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},tt=be(Xe,[["__scopeId","data-v-74984ed8"]]);export{tt as default};
