import{_ as y,d as u,e as t,f as c,F as h,B as b,s as m,P as v,t as o,R as I,S as A,T as D,j as i,A as p}from"./index-C-qTPntZ.js";const k={name:"TaxManagement",data(){return{activeTab:"input",tabs:[{key:"input",label:"进项发票"},{key:"output",label:"销项发票"},{key:"declaration",label:"税务申报"},{key:"statistics",label:"发票统计"}],datePeriods:[{key:"today",label:"今天"},{key:"thisWeek",label:"本周"},{key:"thisMonth",label:"本月"},{key:"thisYear",label:"本年"},{key:"lastSixMonths",label:"最近6个月"},{key:"custom",label:"自定义"}],selectedPeriod:"lastSixMonths",customStartDate:"",customEndDate:"",dateRange:{startDate:null,endDate:null},loading:!1,inputInvoices:[],outputInvoices:[],taxDeclaration:{outputTaxAmount:0,inputTaxAmount:0,payableTaxAmount:0,outputAmount:0,inputAmount:0,outputInvoiceCount:0,inputInvoiceCount:0,authenticatedInputCount:0},customerStatistics:[],showCreateInputInvoiceDialog:!1,newInputInvoice:{purchaseId:null,invoiceNumber:"",invoiceType:"SPECIAL",taxRate:.13,invoiceDate:null}}},computed:{totalStatistics(){return{invoiceCount:this.customerStatistics.reduce((a,e)=>a+e.invoiceCount,0),totalAmount:this.customerStatistics.reduce((a,e)=>a+parseFloat(e.totalAmount||0),0),totalTax:this.customerStatistics.reduce((a,e)=>a+parseFloat(e.totalTax||0),0),totalAmountWithTax:this.customerStatistics.reduce((a,e)=>a+parseFloat(e.totalAmountWithTax||0),0)}}},mounted(){this.selectDatePeriod("lastSixMonths")},methods:{selectDatePeriod(a){this.selectedPeriod=a;const e=new Date;let r,d;switch(a){case"today":r=new Date(e.setHours(0,0,0,0)),d=new Date(e.setHours(23,59,59,999));break;case"thisWeek":const n=e.getDay(),l=e.getDate()-n+(n===0?-6:1);r=new Date(e.setDate(l)),r.setHours(0,0,0,0),d=new Date(r),d.setDate(r.getDate()+6),d.setHours(23,59,59,999);break;case"thisMonth":r=new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0),d=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59,999);break;case"thisYear":r=new Date(e.getFullYear(),0,1,0,0,0,0),d=new Date(e.getFullYear(),11,31,23,59,59,999);break;case"lastSixMonths":r=new Date(e),r.setMonth(e.getMonth()-6),r.setHours(0,0,0,0),d=new Date(e.setHours(23,59,59,999));break;case"custom":return}this.dateRange.startDate=r.toISOString(),this.dateRange.endDate=d.toISOString(),this.loadData()},async loadData(){var a,e;if(this.selectedPeriod==="custom"){if(!this.customStartDate||!this.customEndDate){alert("请选择日期范围");return}this.dateRange.startDate=new Date(this.customStartDate).toISOString(),this.dateRange.endDate=new Date(this.customEndDate).toISOString()}this.loading=!0;try{await Promise.all([this.loadInputInvoices(),this.loadOutputInvoices(),this.loadTaxDeclaration(),this.loadCustomerStatistics()])}catch(r){console.error("加载数据失败:",r),alert("加载数据失败: "+(((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)||r.message))}finally{this.loading=!1}},async loadInputInvoices(){const a=await D.get("/invoices/input",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.inputInvoices=Array.isArray(a)?a:[]},async loadOutputInvoices(){const a=await D.get("/invoices/output",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.outputInvoices=Array.isArray(a)?a:[]},async loadTaxDeclaration(){const a=await D.get("/invoices/tax-declaration",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.taxDeclaration=a||{outputTaxAmount:0,inputTaxAmount:0,payableTaxAmount:0,outputAmount:0,inputAmount:0,outputInvoiceCount:0,inputInvoiceCount:0,authenticatedInputCount:0}},async loadCustomerStatistics(){const a=await D.get("/invoices/statistics/by-customer",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.customerStatistics=Array.isArray(a)?a:[]},async createInputInvoice(){var a,e;try{await D.post("/invoices/input",this.newInputInvoice),alert("进项发票创建成功"),this.showCreateInputInvoiceDialog=!1,this.newInputInvoice={purchaseId:null,invoiceNumber:"",invoiceType:"SPECIAL",taxRate:.13,invoiceDate:null},await this.loadData()}catch(r){console.error("创建进项发票失败:",r),alert("创建失败: "+(((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)||r.message))}},async authenticateInvoice(a){var r,d;const e=prompt("请输入认证备注（可选）:");if(e!==null)try{await D.post(`/invoices/${a}/authenticate`,{remark:e||""}),alert("发票认证成功"),await this.loadData()}catch(n){console.error("认证失败:",n),alert("认证失败: "+(((d=(r=n.response)==null?void 0:r.data)==null?void 0:d.message)||n.message))}},viewInvoiceDetails(a){alert(`发票详情:
`+JSON.stringify(a,null,2))},formatAmount(a){return a?parseFloat(a).toFixed(2):"0.00"},formatDateTime(a){return a?new Date(a).toLocaleString("zh-CN"):"-"},formatDate(a){return a?new Date(a).toLocaleDateString("zh-CN"):"-"},getStatusText(a){return{ISSUED:"已开具",VOIDED:"已作废",RETURNED:"已红冲"}[a]||a},getStatusClass(a){return{ISSUED:"badge-success",VOIDED:"badge-danger",RETURNED:"badge-warning"}[a]||"badge-default"}}},x={class:"tax-management"},f={class:"date-selector"},_={class:"date-buttons"},S=["onClick"],w={key:0,class:"custom-date-range"},T={class:"tabs"},C=["onClick"],R={key:0,class:"tab-content"},E={class:"actions-bar"},M={key:0,class:"loading"},P={key:1,class:"no-data"},N={key:2,class:"invoice-table"},U={class:"amount"},F={class:"amount"},L={class:"amount"},O={key:0,class:"badge badge-success"},V={key:1,class:"badge badge-warning"},W=["onClick"],H=["onClick"],Y={key:1,class:"tab-content"},q={key:0,class:"loading"},B={key:1,class:"no-data"},z={key:2,class:"invoice-table"},j={class:"amount"},J={class:"amount"},G={class:"amount"},K=["onClick"],Q={key:2,class:"tab-content"},X={key:0,class:"loading"},Z={key:1,class:"declaration-content"},$={class:"declaration-period"},tt={class:"declaration-cards"},et={class:"decl-card"},st={class:"decl-value output-tax"},nt={class:"decl-detail"},at={class:"decl-detail"},lt={class:"decl-card"},ot={class:"decl-value input-tax"},ut={class:"decl-detail"},it={class:"decl-detail"},rt={class:"decl-card highlight"},dt={class:"decl-value payable-tax"},ct={class:"declaration-table"},mt={class:"tax-table"},vt={class:"amount"},Dt={class:"highlight-row"},pt={class:"amount"},ht={class:"amount"},bt={class:"amount"},gt={class:"total-row"},It={class:"amount bold"},yt={key:3,class:"tab-content"},At={key:0,class:"loading"},kt={key:1,class:"statistics-content"},xt={key:0,class:"no-data"},ft={key:1,class:"statistics-table"},_t={class:"amount"},St={class:"amount"},wt={class:"amount"},Tt={class:"total-row"},Ct={class:"amount"},Rt={class:"amount"},Et={class:"amount"},Mt={class:"modal-content"},Pt={class:"form-group"},Nt={class:"form-group"},Ut={class:"form-group"},Ft={class:"form-group"},Lt={class:"form-group"},Ot={class:"form-actions"};function Vt(a,e,r,d,n,l){return i(),u("div",x,[e[45]||(e[45]=t("h1",null,"税务管理",-1)),t("div",f,[t("div",_,[(i(!0),u(h,null,b(n.datePeriods,s=>(i(),u("button",{key:s.key,onClick:g=>l.selectDatePeriod(s.key),class:p(["date-btn",{active:n.selectedPeriod===s.key}])},o(s.label),11,S))),128))]),n.selectedPeriod==="custom"?(i(),u("div",w,[m(t("input",{type:"datetime-local","onUpdate:modelValue":e[0]||(e[0]=s=>n.customStartDate=s)},null,512),[[v,n.customStartDate]]),e[12]||(e[12]=t("span",null,"至",-1)),m(t("input",{type:"datetime-local","onUpdate:modelValue":e[1]||(e[1]=s=>n.customEndDate=s)},null,512),[[v,n.customEndDate]]),t("button",{onClick:e[2]||(e[2]=(...s)=>l.loadData&&l.loadData(...s)),class:"refresh-btn"},"查询")])):c("",!0)]),t("div",T,[(i(!0),u(h,null,b(n.tabs,s=>(i(),u("div",{key:s.key,onClick:g=>n.activeTab=s.key,class:p(["tab",{active:n.activeTab===s.key}])},o(s.label),11,C))),128))]),n.activeTab==="input"?(i(),u("div",R,[t("div",E,[t("button",{onClick:e[3]||(e[3]=s=>n.showCreateInputInvoiceDialog=!0),class:"create-btn"}," ➕ 录入进项发票 ")]),n.loading?(i(),u("div",M,"加载中...")):n.inputInvoices.length===0?(i(),u("div",P,"暂无进项发票数据")):(i(),u("table",N,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"发票号码"),t("th",null,"供应商"),t("th",null,"发票日期"),t("th",null,"发票类型"),t("th",null,"金额（不含税）"),t("th",null,"税额"),t("th",null,"价税合计"),t("th",null,"认证状态"),t("th",null,"状态"),t("th",null,"操作")])],-1)),t("tbody",null,[(i(!0),u(h,null,b(n.inputInvoices,s=>(i(),u("tr",{key:s.id},[t("td",null,o(s.invoiceNumber),1),t("td",null,o(s.companyName),1),t("td",null,o(l.formatDateTime(s.invoiceDate)),1),t("td",null,[t("span",{class:p(["badge",s.invoiceType==="SPECIAL"?"badge-special":"badge-normal"])},o(s.invoiceType==="SPECIAL"?"专用发票":"普通发票"),3)]),t("td",U,"¥"+o(l.formatAmount(s.totalAmount)),1),t("td",F,"¥"+o(l.formatAmount(s.taxAmount)),1),t("td",L,"¥"+o(l.formatAmount(s.amountWithTax)),1),t("td",null,[s.isAuthenticated?(i(),u("span",O," 已认证 ("+o(l.formatDate(s.authenticationDate))+") ",1)):(i(),u("span",V,"未认证"))]),t("td",null,[t("span",{class:p(["badge",l.getStatusClass(s.status)])},o(l.getStatusText(s.status)),3)]),t("td",null,[!s.isAuthenticated&&s.status==="ISSUED"?(i(),u("button",{key:0,onClick:g=>l.authenticateInvoice(s.id),class:"action-btn auth-btn"}," 认证 ",8,W)):c("",!0),t("button",{onClick:g=>l.viewInvoiceDetails(s),class:"action-btn view-btn"}," 查看 ",8,H)])]))),128))])]))])):c("",!0),n.activeTab==="output"?(i(),u("div",Y,[n.loading?(i(),u("div",q,"加载中...")):n.outputInvoices.length===0?(i(),u("div",B,"暂无销项发票数据")):(i(),u("table",z,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"发票号码"),t("th",null,"客户"),t("th",null,"发票日期"),t("th",null,"发票类型"),t("th",null,"金额（不含税）"),t("th",null,"税额"),t("th",null,"价税合计"),t("th",null,"状态"),t("th",null,"操作")])],-1)),t("tbody",null,[(i(!0),u(h,null,b(n.outputInvoices,s=>(i(),u("tr",{key:s.id},[t("td",null,o(s.invoiceNumber),1),t("td",null,o(s.companyName),1),t("td",null,o(l.formatDateTime(s.invoiceDate)),1),t("td",null,[t("span",{class:p(["badge",s.invoiceType==="SPECIAL"?"badge-special":"badge-normal"])},o(s.invoiceType==="SPECIAL"?"专用发票":"普通发票"),3)]),t("td",j,"¥"+o(l.formatAmount(s.totalAmount)),1),t("td",J,"¥"+o(l.formatAmount(s.taxAmount)),1),t("td",G,"¥"+o(l.formatAmount(s.amountWithTax)),1),t("td",null,[t("span",{class:p(["badge",l.getStatusClass(s.status)])},o(l.getStatusText(s.status)),3)]),t("td",null,[t("button",{onClick:g=>l.viewInvoiceDetails(s),class:"action-btn view-btn"}," 查看 ",8,K)])]))),128))])]))])):c("",!0),n.activeTab==="declaration"?(i(),u("div",Q,[n.loading?(i(),u("div",X,"加载中...")):(i(),u("div",Z,[e[32]||(e[32]=t("h2",null,"增值税申报汇总表",-1)),t("div",$," 申报期间："+o(l.formatDateTime(n.dateRange.startDate))+" 至 "+o(l.formatDateTime(n.dateRange.endDate)),1),t("div",tt,[t("div",et,[e[15]||(e[15]=t("div",{class:"decl-label"},"销项税额",-1)),t("div",st,"¥"+o(l.formatAmount(n.taxDeclaration.outputTaxAmount)),1),t("div",nt,"销售额: ¥"+o(l.formatAmount(n.taxDeclaration.outputAmount)),1),t("div",at,"发票数量: "+o(n.taxDeclaration.outputInvoiceCount),1)]),t("div",lt,[e[16]||(e[16]=t("div",{class:"decl-label"},"进项税额",-1)),t("div",ot,"¥"+o(l.formatAmount(n.taxDeclaration.inputTaxAmount)),1),t("div",ut,"采购额: ¥"+o(l.formatAmount(n.taxDeclaration.inputAmount)),1),t("div",it," 已认证: "+o(n.taxDeclaration.authenticatedInputCount)+" / "+o(n.taxDeclaration.inputInvoiceCount),1)]),t("div",rt,[e[17]||(e[17]=t("div",{class:"decl-label"},"应纳税额",-1)),t("div",dt,"¥"+o(l.formatAmount(n.taxDeclaration.payableTaxAmount)),1),e[18]||(e[18]=t("div",{class:"decl-formula"},"销项税额 - 进项税额",-1))])]),t("div",ct,[e[31]||(e[31]=t("h3",null,"增值税纳税申报表（简表）",-1)),t("table",mt,[e[30]||(e[30]=t("thead",null,[t("tr",null,[t("th",null,"栏次"),t("th",null,"项目"),t("th",null,"金额（元）")])],-1)),t("tbody",null,[t("tr",null,[e[19]||(e[19]=t("td",null,"1",-1)),e[20]||(e[20]=t("td",null,"销售额（不含税）",-1)),t("td",vt,o(l.formatAmount(n.taxDeclaration.outputAmount)),1)]),t("tr",Dt,[e[21]||(e[21]=t("td",null,"2",-1)),e[22]||(e[22]=t("td",null,"销项税额",-1)),t("td",pt,o(l.formatAmount(n.taxDeclaration.outputTaxAmount)),1)]),t("tr",null,[e[23]||(e[23]=t("td",null,"3",-1)),e[24]||(e[24]=t("td",null,"进项税额",-1)),t("td",ht,o(l.formatAmount(n.taxDeclaration.inputTaxAmount)),1)]),e[29]||(e[29]=t("tr",null,[t("td",null,"4"),t("td",null,"上期留抵税额"),t("td",{class:"amount"},"0.00")],-1)),t("tr",null,[e[25]||(e[25]=t("td",null,"5",-1)),e[26]||(e[26]=t("td",null,"应抵扣税额合计（3+4）",-1)),t("td",bt,o(l.formatAmount(n.taxDeclaration.inputTaxAmount)),1)]),t("tr",gt,[e[27]||(e[27]=t("td",null,"6",-1)),e[28]||(e[28]=t("td",null,"应纳税额（2-5）",-1)),t("td",It,o(l.formatAmount(n.taxDeclaration.payableTaxAmount)),1)])])])])]))])):c("",!0),n.activeTab==="statistics"?(i(),u("div",yt,[n.loading?(i(),u("div",At,"加载中...")):(i(),u("div",kt,[e[35]||(e[35]=t("h2",null,"按客户统计发票",-1)),n.customerStatistics.length===0?(i(),u("div",xt,"暂无统计数据")):(i(),u("table",ft,[e[34]||(e[34]=t("thead",null,[t("tr",null,[t("th",null,"客户名称"),t("th",null,"发票数量"),t("th",null,"销售额（不含税）"),t("th",null,"税额"),t("th",null,"价税合计")])],-1)),t("tbody",null,[(i(!0),u(h,null,b(n.customerStatistics,s=>(i(),u("tr",{key:s.customerId},[t("td",null,o(s.customerName),1),t("td",null,o(s.invoiceCount),1),t("td",_t,"¥"+o(l.formatAmount(s.totalAmount)),1),t("td",St,"¥"+o(l.formatAmount(s.totalTax)),1),t("td",wt,"¥"+o(l.formatAmount(s.totalAmountWithTax)),1)]))),128))]),t("tfoot",null,[t("tr",Tt,[e[33]||(e[33]=t("td",null,"合计",-1)),t("td",null,o(l.totalStatistics.invoiceCount),1),t("td",Ct,"¥"+o(l.formatAmount(l.totalStatistics.totalAmount)),1),t("td",Rt,"¥"+o(l.formatAmount(l.totalStatistics.totalTax)),1),t("td",Et,"¥"+o(l.formatAmount(l.totalStatistics.totalAmountWithTax)),1)])])]))]))])):c("",!0),n.showCreateInputInvoiceDialog?(i(),u("div",{key:4,class:"modal-overlay",onClick:e[11]||(e[11]=I(s=>n.showCreateInputInvoiceDialog=!1,["self"]))},[t("div",Mt,[e[44]||(e[44]=t("h2",null,"录入进项发票",-1)),t("form",{onSubmit:e[10]||(e[10]=I((...s)=>l.createInputInvoice&&l.createInputInvoice(...s),["prevent"]))},[t("div",Pt,[e[36]||(e[36]=t("label",null,"采购单ID *",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=s=>n.newInputInvoice.purchaseId=s),required:""},null,512),[[v,n.newInputInvoice.purchaseId]])]),t("div",Nt,[e[37]||(e[37]=t("label",null,"发票号码 *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>n.newInputInvoice.invoiceNumber=s),required:""},null,512),[[v,n.newInputInvoice.invoiceNumber]])]),t("div",Ut,[e[39]||(e[39]=t("label",null,"发票类型 *",-1)),m(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.newInputInvoice.invoiceType=s),required:""},[...e[38]||(e[38]=[t("option",{value:"SPECIAL"},"专用发票",-1),t("option",{value:"NORMAL"},"普通发票",-1)])],512),[[A,n.newInputInvoice.invoiceType]])]),t("div",Ft,[e[40]||(e[40]=t("label",null,"税率 *",-1)),m(t("input",{type:"number",step:"0.01","onUpdate:modelValue":e[7]||(e[7]=s=>n.newInputInvoice.taxRate=s),required:""},null,512),[[v,n.newInputInvoice.taxRate]]),e[41]||(e[41]=t("small",null,"例如：13% 填写 0.13",-1))]),t("div",Lt,[e[42]||(e[42]=t("label",null,"发票日期",-1)),m(t("input",{type:"datetime-local","onUpdate:modelValue":e[8]||(e[8]=s=>n.newInputInvoice.invoiceDate=s)},null,512),[[v,n.newInputInvoice.invoiceDate]])]),t("div",Ot,[t("button",{type:"button",onClick:e[9]||(e[9]=s=>n.showCreateInputInvoiceDialog=!1),class:"cancel-btn"}," 取消 "),e[43]||(e[43]=t("button",{type:"submit",class:"submit-btn"},"创建",-1))])],32)])])):c("",!0)])}const Ht=y(k,[["render",Vt],["__scopeId","data-v-e2d9d5aa"]]);export{Ht as default};
