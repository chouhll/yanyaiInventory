import{_ as Y,r as c,o as Z,d as ee,e as $,h as l,w as t,i,P as f,E as p,j as le,m,t as h,C as D}from"./index-CV1_q4ff.js";const ae={class:"warehouses"},te={class:"page-header"},oe={class:"locations-header"},ue={__name:"Warehouses",setup(ne){const L=c([]),W=c([]),g=c(null),V=c(!1),U=c(!1),y=c(!1),w=c(!1),k=c(!1),n=c({code:"",name:"",type:"",address:"",manager:"",phone:"",enabled:!0,remarks:""}),s=c({code:"",name:"",zone:"",rackNumber:"",level:"",type:"",capacity:null,enabled:!0,remarks:"",warehouse:null}),C=async()=>{try{const o=await f.getAll();o.success&&(L.value=o.data)}catch(o){p.error("åŠ è½½ä»“åº“åˆ—è¡¨å¤±è´¥"),console.error(o)}},M=()=>{w.value=!1,n.value={code:"",name:"",type:"",address:"",manager:"",phone:"",enabled:!0,remarks:""},V.value=!0},I=o=>{w.value=!0,n.value={...o},V.value=!0},O=async()=>{var o,e;try{console.log("ä¿å­˜ä»“åº“ - isEdit:",w.value),console.log("ä¿å­˜ä»“åº“ - è¡¨å•æ•°æ®:",n.value);let u;w.value?(console.log("è°ƒç”¨æ›´æ–°API:",`/api/warehouses/${n.value.id}`),u=await f.update(n.value.id,n.value),p.success("ä»“åº“æ›´æ–°æˆåŠŸ")):(console.log("è°ƒç”¨åˆ›å»ºAPI: POST /api/warehouses"),u=await f.create(n.value),console.log("åˆ›å»ºå“åº”:",u),p.success("ä»“åº“åˆ›å»ºæˆåŠŸ")),V.value=!1,C()}catch(u){console.error("ä¿å­˜ä»“åº“å¤±è´¥:",u),console.error("é”™è¯¯è¯¦æƒ…:",u.response),p.error(((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.message)||u.message||"ä¿å­˜å¤±è´¥")}},F=async o=>{try{await f.toggleStatus(o.id),p.success("çŠ¶æ€æ›´æ–°æˆåŠŸ"),C()}catch{p.error("çŠ¶æ€æ›´æ–°å¤±è´¥")}},T=async o=>{var e,u;try{await D.confirm("ç¡®å®šè¦åˆ é™¤è¯¥ä»“åº“å—ï¼Ÿ","æç¤º",{type:"warning"}),await f.delete(o.id),p.success("ä»“åº“åˆ é™¤æˆåŠŸ"),C()}catch(d){d!=="cancel"&&p.error(((u=(e=d.response)==null?void 0:e.data)==null?void 0:u.message)||"åˆ é™¤å¤±è´¥")}},x=async o=>{g.value=o;try{const e=await f.getLocations(o.id);e.success&&(W.value=e.data),U.value=!0}catch(e){p.error("åŠ è½½åº“ä½å¤±è´¥"),console.error(e)}},j=()=>{k.value=!1,s.value={code:"",name:"",zone:"",rackNumber:"",level:"",type:"",capacity:null,enabled:!0,remarks:"",warehouse:{id:g.value.id}},y.value=!0},H=o=>{k.value=!0,s.value={...o},y.value=!0},G=async()=>{var o,e;try{k.value?(await f.updateLocation(s.value.id,s.value),p.success("åº“ä½æ›´æ–°æˆåŠŸ")):(await f.createLocation(s.value),p.success("åº“ä½åˆ›å»ºæˆåŠŸ")),y.value=!1,x(g.value)}catch(u){p.error(((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.message)||"ä¿å­˜å¤±è´¥")}},J=async o=>{var e,u;try{await D.confirm("ç¡®å®šè¦åˆ é™¤è¯¥åº“ä½å—ï¼Ÿ","æç¤º",{type:"warning"}),await f.deleteLocation(o.id),p.success("åº“ä½åˆ é™¤æˆåŠŸ"),x(g.value)}catch(d){d!=="cancel"&&p.error(((u=(e=d.response)==null?void 0:e.data)==null?void 0:u.message)||"åˆ é™¤å¤±è´¥")}},N=o=>{if(!o.capacity||o.capacity===0)return 0;const e=o.occupied||0;return Math.round(e/o.capacity*100)},K=o=>{const e=N(o);return e>=90?"exception":e>=70?"warning":"success"};return Z(()=>{C()}),(o,e)=>{var B;const u=i("el-button"),d=i("el-table-column"),E=i("el-tag"),A=i("el-table"),Q=i("el-card"),v=i("el-input"),r=i("el-form-item"),b=i("el-option"),P=i("el-select"),S=i("el-switch"),q=i("el-form"),z=i("el-dialog"),R=i("el-progress"),X=i("el-input-number");return le(),ee("div",ae,[$("div",te,[e[23]||(e[23]=$("h2",null,"ðŸ¢ ä»“åº“ç®¡ç†",-1)),l(u,{type:"primary",onClick:M},{default:t(()=>[...e[22]||(e[22]=[m("æ–°å»ºä»“åº“",-1)])]),_:1})]),l(Q,null,{default:t(()=>[l(A,{data:L.value,style:{width:"100%"},stripe:""},{default:t(()=>[l(d,{prop:"code",label:"ä»“åº“ç¼–ç ",width:"120"}),l(d,{prop:"name",label:"ä»“åº“åç§°",width:"150"}),l(d,{prop:"type",label:"ç±»åž‹",width:"100"}),l(d,{prop:"address",label:"åœ°å€","min-width":"200"}),l(d,{prop:"manager",label:"è´Ÿè´£äºº",width:"100"}),l(d,{prop:"phone",label:"è”ç³»ç”µè¯",width:"130"}),l(d,{label:"çŠ¶æ€",width:"80"},{default:t(({row:a})=>[l(E,{type:a.enabled?"success":"info",size:"small"},{default:t(()=>[m(h(a.enabled?"å¯ç”¨":"ç¦ç”¨"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"æ“ä½œ",width:"280",fixed:"right"},{default:t(({row:a})=>[l(u,{size:"small",onClick:_=>x(a)},{default:t(()=>[...e[24]||(e[24]=[m("åº“ä½",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",onClick:_=>I(a)},{default:t(()=>[...e[25]||(e[25]=[m("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:a.enabled?"warning":"success",onClick:_=>F(a)},{default:t(()=>[m(h(a.enabled?"ç¦ç”¨":"å¯ç”¨"),1)]),_:2},1032,["type","onClick"]),l(u,{size:"small",type:"danger",onClick:_=>T(a)},{default:t(()=>[...e[26]||(e[26]=[m("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(z,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=a=>V.value=a),title:w.value?"ç¼–è¾‘ä»“åº“":"æ–°å»ºä»“åº“",width:"600px"},{footer:t(()=>[l(u,{onClick:e[8]||(e[8]=a=>V.value=!1)},{default:t(()=>[...e[27]||(e[27]=[m("å–æ¶ˆ",-1)])]),_:1}),l(u,{type:"primary",onClick:O},{default:t(()=>[...e[28]||(e[28]=[m("ä¿å­˜",-1)])]),_:1})]),default:t(()=>[l(q,{model:n.value,"label-width":"100px"},{default:t(()=>[l(r,{label:"ä»“åº“ç¼–ç ",required:""},{default:t(()=>[l(v,{modelValue:n.value.code,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.code=a),placeholder:"å¦‚: WH001"},null,8,["modelValue"])]),_:1}),l(r,{label:"ä»“åº“åç§°",required:""},{default:t(()=>[l(v,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"ä»“åº“ç±»åž‹"},{default:t(()=>[l(P,{modelValue:n.value.type,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.type=a),placeholder:"è¯·é€‰æ‹©"},{default:t(()=>[l(b,{label:"ä¸»ä»“",value:"ä¸»ä»“"}),l(b,{label:"åˆ†ä»“",value:"åˆ†ä»“"}),l(b,{label:"ä¸­è½¬ä»“",value:"ä¸­è½¬ä»“"}),l(b,{label:"é€€è´§ä»“",value:"é€€è´§ä»“"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"åœ°å€"},{default:t(()=>[l(v,{modelValue:n.value.address,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.address=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(r,{label:"è´Ÿè´£äºº"},{default:t(()=>[l(v,{modelValue:n.value.manager,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.manager=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"è”ç³»ç”µè¯"},{default:t(()=>[l(v,{modelValue:n.value.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.phone=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"å¯ç”¨çŠ¶æ€"},{default:t(()=>[l(S,{modelValue:n.value.enabled,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.enabled=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"å¤‡æ³¨"},{default:t(()=>[l(v,{modelValue:n.value.remarks,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.remarks=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(z,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),title:`${(B=g.value)==null?void 0:B.name} - åº“ä½ç®¡ç†`,width:"80%",top:"5vh"},{default:t(()=>[$("div",oe,[l(u,{type:"primary",size:"small",onClick:j},{default:t(()=>[...e[29]||(e[29]=[m("æ–°å»ºåº“ä½",-1)])]),_:1})]),l(A,{data:W.value,style:{width:"100%"},"max-height":"500"},{default:t(()=>[l(d,{prop:"code",label:"åº“ä½ç¼–ç ",width:"120"}),l(d,{prop:"name",label:"åº“ä½åç§°",width:"150"}),l(d,{prop:"zone",label:"åŒºåŸŸ",width:"100"}),l(d,{prop:"rackNumber",label:"è´§æž¶å·",width:"100"}),l(d,{prop:"level",label:"å±‚å·",width:"80"}),l(d,{prop:"type",label:"ç±»åž‹",width:"100"}),l(d,{label:"å®¹é‡å ç”¨",width:"150"},{default:t(({row:a})=>[l(R,{percentage:N(a),status:K(a),format:()=>`${a.occupied||0}/${a.capacity||0}`},null,8,["percentage","status","format"])]),_:1}),l(d,{label:"çŠ¶æ€",width:"80"},{default:t(({row:a})=>[l(E,{type:a.enabled?"success":"info",size:"small"},{default:t(()=>[m(h(a.enabled?"å¯ç”¨":"ç¦ç”¨"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"æ“ä½œ",width:"150",fixed:"right"},{default:t(({row:a})=>[l(u,{size:"small",onClick:_=>H(a)},{default:t(()=>[...e[30]||(e[30]=[m("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:_=>J(a)},{default:t(()=>[...e[31]||(e[31]=[m("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),l(z,{modelValue:y.value,"onUpdate:modelValue":e[21]||(e[21]=a=>y.value=a),title:k.value?"ç¼–è¾‘åº“ä½":"æ–°å»ºåº“ä½",width:"500px"},{footer:t(()=>[l(u,{onClick:e[20]||(e[20]=a=>y.value=!1)},{default:t(()=>[...e[32]||(e[32]=[m("å–æ¶ˆ",-1)])]),_:1}),l(u,{type:"primary",onClick:G},{default:t(()=>[...e[33]||(e[33]=[m("ä¿å­˜",-1)])]),_:1})]),default:t(()=>[l(q,{model:s.value,"label-width":"100px"},{default:t(()=>[l(r,{label:"åº“ä½ç¼–ç ",required:""},{default:t(()=>[l(v,{modelValue:s.value.code,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.code=a),placeholder:"å¦‚: A-01-01"},null,8,["modelValue"])]),_:1}),l(r,{label:"åº“ä½åç§°",required:""},{default:t(()=>[l(v,{modelValue:s.value.name,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.name=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"åŒºåŸŸ"},{default:t(()=>[l(v,{modelValue:s.value.zone,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.zone=a),placeholder:"å¦‚: AåŒº"},null,8,["modelValue"])]),_:1}),l(r,{label:"è´§æž¶å·"},{default:t(()=>[l(v,{modelValue:s.value.rackNumber,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.rackNumber=a),placeholder:"å¦‚: 01"},null,8,["modelValue"])]),_:1}),l(r,{label:"å±‚å·"},{default:t(()=>[l(v,{modelValue:s.value.level,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.level=a),placeholder:"å¦‚: 01"},null,8,["modelValue"])]),_:1}),l(r,{label:"åº“ä½ç±»åž‹"},{default:t(()=>[l(P,{modelValue:s.value.type,"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.type=a),placeholder:"è¯·é€‰æ‹©"},{default:t(()=>[l(b,{label:"æ™®é€šè´§æž¶",value:"æ™®é€šè´§æž¶"}),l(b,{label:"æ‰˜ç›˜ä½",value:"æ‰˜ç›˜ä½"}),l(b,{label:"å†·è—ä½",value:"å†·è—ä½"}),l(b,{label:"è´µé‡å“åŒº",value:"è´µé‡å“åŒº"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"å®¹é‡"},{default:t(()=>[l(X,{modelValue:s.value.capacity,"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.capacity=a),min:0,step:1},null,8,["modelValue"])]),_:1}),l(r,{label:"å¯ç”¨çŠ¶æ€"},{default:t(()=>[l(S,{modelValue:s.value.enabled,"onUpdate:modelValue":e[18]||(e[18]=a=>s.value.enabled=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"å¤‡æ³¨"},{default:t(()=>[l(v,{modelValue:s.value.remarks,"onUpdate:modelValue":e[19]||(e[19]=a=>s.value.remarks=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},de=Y(ue,[["__scopeId","data-v-335cd4c3"]]);export{de as default};
