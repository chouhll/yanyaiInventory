import{_ as Me,r as x,K as X,o as Be,d as E,e as l,s as $e,h as t,w as a,i,x as k,f as V,v as He,H as ce,b as je,E as b,u as We,M as ve,y as Ye,I as Ke,j as c,m as v,t as u,F as Z,B as ee,C as Ge}from"./index-Dx6wz3Hl.js";const Je={class:"order-detail-page"},Qe={class:"page-header"},Xe={class:"header-left"},Ze={class:"header-info"},et={class:"header-actions"},tt={class:"card-title"},at={class:"status-actions"},lt={class:"card-title"},st={class:"info-item"},ot={class:"info-value"},nt={class:"info-item"},it={class:"info-value"},ut={class:"info-item"},dt={class:"info-value"},rt={class:"info-item"},ct={class:"info-value"},vt={class:"card-title"},pt={class:"product-cell"},ft={class:"product-name"},mt={key:0,class:"product-spec"},_t={class:"price-text"},gt={class:"subtotal-text"},bt={class:"order-summary"},yt={class:"summary-row"},xt={class:"summary-value"},ht={class:"summary-row total"},wt={class:"summary-value total-amount"},It={class:"card-title"},kt={class:"info-item"},Dt={class:"info-value"},Ct={class:"info-item"},Et={class:"info-value"},Pt={class:"info-item"},Vt={class:"info-value"},At={class:"info-item"},Nt={class:"info-value price-text"},Ut={class:"info-item"},St={class:"info-value"},zt={class:"info-item"},Lt={class:"info-value total-amount"},Tt={key:0,style:{"margin-top":"20px"}},Ft={class:"items-container"},Rt={class:"item-form-header"},qt={class:"item-number"},Ot={class:"item-subtotal"},Mt={class:"subtotal-value"},Bt={class:"dialog-footer"},$t={key:1},Ht={class:"invoice-section"},jt={class:"info-item"},Wt={class:"info-value"},Yt={class:"info-item"},Kt={class:"info-value"},Gt={class:"info-item"},Jt={class:"info-value"},Qt={class:"info-item"},Xt={class:"info-value"},Zt={class:"info-item"},ea={class:"info-value"},ta={class:"invoice-calculation"},aa={class:"calc-row"},la={class:"calc-value"},sa={class:"calc-row"},oa={class:"calc-label"},na={class:"calc-value"},ia={class:"calc-row total"},ua={class:"calc-value total-amount"},da={class:"dialog-footer"},ra={class:"invoice-pdf-preview"},ca=["src"],va={key:1,class:"loading-preview"},pa={class:"dialog-footer"},fa={class:"dialog-footer"},ma={__name:"OrderDetail",setup(_a){const he=je(),we=We(),n=x({items:[],customer:{}}),j=x([]),pe=x([]),te=x(!1),T=x(!1),F=x(!1),h=x(!1),Ie=x(!1),R=x(""),w=x(null),q=x(!1),O=x(!1),S=x(""),I=x({customerId:null,items:[]}),D=x({invoiceType:"NORMAL",taxRate:.13}),ae=[{value:"CREATED",label:"已创建"},{value:"UNPAID",label:"未付款"},{value:"PAID",label:"已付款"},{value:"INVOICED",label:"已开票"},{value:"SHIPPED",label:"已发货"},{value:"COMPLETED",label:"已完成"}],fe=X(()=>{if(n.value.status==="CANCELLED")return-1;const o=ae.findIndex(e=>e.value===n.value.status);return o>=0?o:0}),z=X(()=>n.value.items?n.value.items.reduce((o,e)=>o+(e.subtotal||0),0):0),le=X(()=>(z.value*D.value.taxRate).toFixed(2)),me=X(()=>(z.value+parseFloat(le.value)).toFixed(2)),M=async()=>{te.value=!0;try{n.value=await ce.getById(he.params.id),R.value=n.value.status}catch{b.error("加载订单详情失败"),we.back()}finally{te.value=!1}},ke=async()=>{try{j.value=await Ye.getAll()}catch{b.error("加载产品列表失败")}},De=async()=>{try{pe.value=await Ke.getAll()}catch{b.error("加载客户列表失败")}},se=async()=>{if(n.value&&n.value.id)try{w.value=await ve.getByOrder(n.value.id)}catch{w.value=null}},Ce=()=>{var o;if(!((o=n.value.customer)!=null&&o.taxNumber)){b.warning("客户开票信息不完整，请先完善客户的税号等信息");return}q.value=!0},Ee=o=>{const e=ae.findIndex(d=>d.value===o),m=fe.value;return n.value.status==="CANCELLED"?"error":e<m?"finish":e===m?"process":"wait"},_e=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",ge=o=>({CREATED:"info",UNPAID:"warning",PAID:"success",INVOICED:"primary",SHIPPED:"",COMPLETED:"success",CANCELLED:"danger"})[o]||"info",be=o=>({CREATED:"已创建",UNPAID:"未付款",PAID:"已付款",INVOICED:"已开票",SHIPPED:"已发货",COMPLETED:"已完成",CANCELLED:"已取消"})[o]||o,Pe=()=>{var o;I.value={customerId:(o=n.value.customer)==null?void 0:o.id,items:n.value.items.map(e=>{var m;return{productId:(m=e.product)==null?void 0:m.id,quantity:e.quantity,unitPrice:e.unitPrice,costUnitPrice:e.costUnitPrice||e.unitPrice}})},T.value=!0},Ve=o=>{const e=j.value.find(m=>m.id===o.productId);e&&(o.unitPrice=e.price||0,o.costUnitPrice=e.price||0)},Ae=()=>{I.value.items.push({productId:null,quantity:1,unitPrice:0,costUnitPrice:0})},Ne=o=>{I.value.items.splice(o,1)},Ue=async()=>{var e,m;if(!I.value.customerId){b.warning("请选择客户");return}if(I.value.items.some(d=>!d.productId||d.quantity<=0)){b.warning("请完整填写所有订单项");return}h.value=!0;try{const d={id:n.value.id,customer:{id:I.value.customerId},status:n.value.status,items:I.value.items.map(r=>{const p=j.value.find(B=>B.id===r.productId);return{product:{id:r.productId},quantity:r.quantity,unitPrice:r.unitPrice||(p==null?void 0:p.price)||0,costUnitPrice:r.costUnitPrice||(p==null?void 0:p.price)||0,subtotal:r.quantity*(r.unitPrice||(p==null?void 0:p.price)||0),costSubtotal:r.quantity*(r.costUnitPrice||(p==null?void 0:p.price)||0)}})};await ce.update(n.value.id,d),b.success("订单更新成功"),T.value=!1,M()}catch(d){b.error("更新失败: "+(((m=(e=d.response)==null?void 0:e.data)==null?void 0:m.message)||d.message))}finally{h.value=!1}},Se=async()=>{if(!R.value){b.warning("请选择新状态");return}h.value=!0;try{await ce.updateStatus(n.value.id,R.value),b.success("状态更新成功"),F.value=!1,M()}catch{b.error("状态更新失败")}finally{h.value=!1}},ze=()=>{var A,W,U,Y,N,K,g;const o="INV-"+new Date().getFullYear()+String(new Date().getMonth()+1).padStart(2,"0")+String(new Date().getDate()).padStart(2,"0")+"-"+Math.random().toString(36).substr(2,4).toUpperCase(),e=new Date().toLocaleDateString("zh-CN"),m=D.value.invoiceType==="SPECIAL"?"专用":"普通",d=((A=n.value.customer)==null?void 0:A.companyName)||((W=n.value.customer)==null?void 0:W.name)||"",r=((U=n.value.customer)==null?void 0:U.taxNumber)||"",p=((Y=n.value.customer)==null?void 0:Y.companyAddress)||"",B=(((N=n.value.customer)==null?void 0:N.bankName)||"")+" "+(((K=n.value.customer)==null?void 0:K.bankAccount)||""),$=n.value.orderNumber,oe=z.value.toFixed(2),ne=(D.value.taxRate*100).toFixed(0),ie=le.value,ue=me.value,L=((g=n.value.items)==null?void 0:g.map(P=>{var C,G,H,J;return"<tr><td>"+(((C=P.product)==null?void 0:C.name)||"")+"</td><td>"+(((G=P.product)==null?void 0:G.specification)||"-")+'</td><td class="amount">'+P.quantity+'</td><td class="amount">¥'+((H=P.unitPrice)==null?void 0:H.toFixed(2))+'</td><td class="amount">¥'+((J=P.subtotal)==null?void 0:J.toFixed(2))+"</td></tr>"}).join(""))||"",de=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <style>
        body { font-family: 'SimSun', serif; padding: 40px; background: #f5f5f5; }
        .invoice { background: white; border: 2px solid #000; padding: 40px; max-width: 900px; margin: 0 auto; }
        .header { text-align: center; font-size: 28px; font-weight: bold; margin-bottom: 30px; color: #333; }
        .invoice-no { text-align: right; color: #d32f2f; margin-bottom: 25px; font-size: 16px; }
        .section { margin: 25px 0; }
        .section-title { font-weight: bold; background: #f0f0f0; padding: 10px 15px; margin: 15px 0; border-left: 4px solid #1976d2; }
        .info-row { margin: 12px 0; line-height: 1.8; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #f5f5f5; font-weight: 600; }
        .amount { text-align: right; }
        .total-row { font-weight: bold; background: #fafafa; }
        .highlight-row { font-size: 18px; background: #fff3e0; }
        .highlight-row td:last-child { color: #d32f2f; font-size: 20px; font-weight: 700; }
        .footer { margin-top: 40px; }
        .note-text { min-height: 60px; color: #666; }
        .stamp { text-align: right; margin-top: 50px; color: #666; }
        .stamp-text { margin-top: 30px; font-size: 14px; }
        .stamp-notice { margin-top: 50px; color: #999; }
      </style>
    </head>
    <body>
      <div class="invoice">
        <div class="header">增值税`+m+`发票</div>
        <div class="invoice-no">发票号码：`+o+`</div>
        
        <div class="section">
          <div class="section-title">购买方信息</div>
          <div class="info-row"><strong>名称：</strong>`+d+`</div>
          <div class="info-row"><strong>纳税人识别号：</strong>`+r+`</div>
          <div class="info-row"><strong>地址、电话：</strong>`+p+`</div>
          <div class="info-row"><strong>开户行及账号：</strong>`+B+`</div>
        </div>
        
        <div class="section">
          <div class="section-title">订单明细</div>
          <div class="info-row"><strong>订单号：</strong>`+$+`</div>
          <div class="info-row"><strong>开票日期：</strong>`+e+`</div>
          
          <table>
            <thead>
              <tr>
                <th>货物或应税劳务名称</th>
                <th>规格型号</th>
                <th class="amount">数量</th>
                <th class="amount">单价</th>
                <th class="amount">金额</th>
              </tr>
            </thead>
            <tbody>
              `+L+`
              <tr class="total-row">
                <td colspan="4">合计金额</td>
                <td class="amount">¥`+oe+`</td>
              </tr>
              <tr class="total-row">
                <td colspan="4">税率 `+ne+`%</td>
                <td class="amount">¥`+ie+`</td>
              </tr>
              <tr class="total-row highlight-row">
                <td colspan="4">价税合计（大写）</td>
                <td class="amount">¥`+ue+`</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="footer">
          <div class="section-title">备注</div>
          <p class="note-text">本发票由系统生成，仅供预览使用。</p>
          <div class="stamp">
            <p class="stamp-text">销售方（公章）</p>
            <p class="stamp-notice">[此为系统生成的模拟发票]</p>
          </div>
        </div>
      </div>
    </body>
    </html>
  `,f=new Blob([de],{type:"text/html"});return URL.createObjectURL(f)},Le=()=>{var o;if(!((o=n.value.customer)!=null&&o.taxNumber)){b.warning("客户开票信息不完整");return}S.value=ze(),q.value=!1,O.value=!0},Te=async()=>{var o,e;h.value=!0;try{const m={orderId:n.value.id,invoiceType:D.value.invoiceType,taxRate:D.value.taxRate};await ve.issue(m),b.success("发票开具成功"),O.value=!1,S.value&&(URL.revokeObjectURL(S.value),S.value=""),await M(),await se()}catch(m){const d=((e=(o=m.response)==null?void 0:o.data)==null?void 0:e.message)||m.message||"开票失败";b.error(d)}finally{h.value=!1}},Fe=async()=>{try{const o=await Ge.prompt("请输入作废原因","作废发票",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入作废原因"});h.value=!0,await ve.void(w.value.id,o.value),b.success("发票已作废"),await M(),await se()}catch(o){o!=="cancel"&&b.error("作废失败")}finally{h.value=!1}};return Be(async()=>{await M(),await se(),ke(),De()}),(o,e)=>{const m=i("ArrowLeft"),d=i("el-icon"),r=i("el-button"),p=i("el-tag"),B=i("Edit"),$=i("Document"),oe=i("Histogram"),ne=i("el-step"),ie=i("el-steps"),ue=i("Refresh"),L=i("el-card"),de=i("InfoFilled"),f=i("el-col"),A=i("el-row"),W=i("ShoppingCart"),U=i("el-table-column"),Y=i("el-table"),N=i("el-divider"),K=i("Close"),g=i("el-option"),P=i("el-select"),C=i("el-form-item"),G=i("Delete"),H=i("el-input-number"),J=i("Plus"),re=i("el-form"),Q=i("el-dialog"),Re=i("el-alert"),ye=i("el-radio"),qe=i("el-radio-group"),xe=i("Check"),Oe=He("loading");return c(),E("div",Je,[l("div",Qe,[l("div",Xe,[t(r,{onClick:e[0]||(e[0]=s=>o.$router.back()),size:"large",plain:""},{default:a(()=>[t(d,null,{default:a(()=>[t(m)]),_:1}),e[14]||(e[14]=v(" 返回 ",-1))]),_:1}),l("div",Ze,[e[15]||(e[15]=l("h2",{class:"page-title"},"订单详情",-1)),t(p,{type:ge(n.value.status),size:"large",effect:"dark"},{default:a(()=>[v(u(be(n.value.status)),1)]),_:1},8,["type"])])]),l("div",et,[Ie.value?V("",!0):(c(),k(r,{key:0,type:"primary",onClick:Pe,size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t(B)]),_:1}),e[16]||(e[16]=v(" 编辑订单 ",-1))]),_:1})),n.value.status==="PAID"&&!w.value?(c(),k(r,{key:1,type:"warning",onClick:Ce,size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t($)]),_:1}),e[17]||(e[17]=v(" 开具发票 ",-1))]),_:1})):V("",!0)])]),$e((c(),k(A,{gutter:20},{default:a(()=>[t(f,{span:24},{default:a(()=>[t(L,{shadow:"hover",class:"status-card"},{header:a(()=>[l("div",tt,[t(d,null,{default:a(()=>[t(oe)]),_:1}),e[18]||(e[18]=l("span",null,"订单状态流程",-1))])]),default:a(()=>[t(ie,{active:fe.value,"finish-status":"success","align-center":""},{default:a(()=>[(c(),E(Z,null,ee(ae,s=>t(ne,{key:s.value,title:s.label,status:Ee(s.value)},null,8,["title","status"])),64))]),_:1},8,["active"]),l("div",at,[t(r,{type:"primary",onClick:e[1]||(e[1]=s=>F.value=!0),size:"default"},{default:a(()=>[t(d,null,{default:a(()=>[t(ue)]),_:1}),e[19]||(e[19]=v(" 更新状态 ",-1))]),_:1})])]),_:1}),t(L,{shadow:"hover",class:"info-card"},{header:a(()=>[l("div",lt,[t(d,null,{default:a(()=>[t(de)]),_:1}),e[20]||(e[20]=l("span",null,"基本信息",-1))])]),default:a(()=>[t(A,{gutter:20},{default:a(()=>[t(f,{span:12},{default:a(()=>[l("div",st,[e[21]||(e[21]=l("span",{class:"info-label"},"订单号:",-1)),l("span",ot,u(n.value.orderNumber||"-"),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",nt,[e[22]||(e[22]=l("span",{class:"info-label"},"订单ID:",-1)),l("span",it,"#"+u(n.value.id),1)])]),_:1}),t(f,{span:12},{default:a(()=>{var s;return[l("div",ut,[e[23]||(e[23]=l("span",{class:"info-label"},"客户:",-1)),l("span",dt,u(((s=n.value.customer)==null?void 0:s.name)||"-"),1)])]}),_:1}),t(f,{span:12},{default:a(()=>[l("div",rt,[e[24]||(e[24]=l("span",{class:"info-label"},"订单日期:",-1)),l("span",ct,u(_e(n.value.orderDate)),1)])]),_:1})]),_:1})]),_:1}),t(L,{shadow:"hover",class:"items-card"},{header:a(()=>[l("div",vt,[t(d,null,{default:a(()=>[t(W)]),_:1}),e[25]||(e[25]=l("span",null,"订单商品",-1))])]),default:a(()=>[t(Y,{data:n.value.items,border:"","header-cell-style":{background:"#f5f7fa",fontWeight:"600"}},{default:a(()=>[t(U,{label:"产品名称","min-width":"180"},{default:a(({row:s})=>{var _,y;return[l("div",pt,[l("span",ft,u(((_=s.product)==null?void 0:_.name)||"-"),1),(y=s.product)!=null&&y.specification?(c(),E("span",mt,u(s.product.specification),1)):V("",!0)])]}),_:1}),t(U,{prop:"quantity",label:"数量",width:"100",align:"center"},{default:a(({row:s})=>[t(p,{type:"info",size:"large"},{default:a(()=>[v(u(s.quantity),1)]),_:2},1024)]),_:1}),t(U,{label:"单价",width:"120",align:"right"},{default:a(({row:s})=>{var _;return[l("span",_t,"¥"+u(((_=s.unitPrice)==null?void 0:_.toFixed(2))||"0.00"),1)]}),_:1}),t(U,{label:"小计",width:"140",align:"right"},{default:a(({row:s})=>{var _;return[l("span",gt,"¥"+u(((_=s.subtotal)==null?void 0:_.toFixed(2))||"0.00"),1)]}),_:1})]),_:1},8,["data"]),l("div",bt,[l("div",yt,[e[26]||(e[26]=l("span",{class:"summary-label"},"商品总额:",-1)),l("span",xt,"¥"+u(z.value.toFixed(2)),1)]),t(N,{style:{margin:"12px 0"}}),l("div",ht,[e[27]||(e[27]=l("span",{class:"summary-label"},"订单总计:",-1)),l("span",wt,"¥"+u(z.value.toFixed(2)),1)])])]),_:1}),w.value?(c(),k(L,{key:0,shadow:"hover",class:"invoice-card"},{header:a(()=>[l("div",It,[t(d,null,{default:a(()=>[t($)]),_:1}),e[30]||(e[30]=l("span",null,"发票信息",-1)),w.value.status==="ISSUED"?(c(),k(p,{key:0,type:"success",effect:"dark",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[28]||(e[28]=[v(" 已开具 ",-1)])]),_:1})):w.value.status==="VOIDED"?(c(),k(p,{key:1,type:"info",size:"default",style:{"margin-left":"auto"}},{default:a(()=>[...e[29]||(e[29]=[v(" 已作废 ",-1)])]),_:1})):V("",!0)])]),default:a(()=>[t(A,{gutter:20},{default:a(()=>[t(f,{span:12},{default:a(()=>[l("div",kt,[e[31]||(e[31]=l("span",{class:"info-label"},"发票号码:",-1)),l("span",Dt,u(w.value.invoiceNumber),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",Ct,[e[32]||(e[32]=l("span",{class:"info-label"},"开票日期:",-1)),l("span",Et,u(_e(w.value.invoiceDate)),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",Pt,[e[33]||(e[33]=l("span",{class:"info-label"},"发票类型:",-1)),l("span",Vt,u(w.value.invoiceType==="NORMAL"?"普通发票":"专用发票"),1)])]),_:1}),t(f,{span:12},{default:a(()=>{var s;return[l("div",At,[e[34]||(e[34]=l("span",{class:"info-label"},"总金额:",-1)),l("span",Nt,"¥"+u(((s=w.value.totalAmount)==null?void 0:s.toFixed(2))||"0.00"),1)])]}),_:1}),t(f,{span:12},{default:a(()=>{var s;return[l("div",Ut,[e[35]||(e[35]=l("span",{class:"info-label"},"税额:",-1)),l("span",St,"¥"+u(((s=w.value.taxAmount)==null?void 0:s.toFixed(2))||"0.00"),1)])]}),_:1}),t(f,{span:12},{default:a(()=>{var s;return[l("div",zt,[e[36]||(e[36]=l("span",{class:"info-label"},"价税合计:",-1)),l("span",Lt,"¥"+u(((s=w.value.amountWithTax)==null?void 0:s.toFixed(2))||"0.00"),1)])]}),_:1})]),_:1}),w.value.status==="ISSUED"?(c(),E("div",Tt,[t(r,{type:"danger",size:"default",onClick:Fe},{default:a(()=>[t(d,null,{default:a(()=>[t(K)]),_:1}),e[37]||(e[37]=v(" 作废发票 ",-1))]),_:1})])):V("",!0)]),_:1})):V("",!0)]),_:1})]),_:1})),[[Oe,te.value]]),t(Q,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=s=>T.value=s),title:"编辑订单",width:"750px","close-on-click-modal":!1},{footer:a(()=>[l("div",Bt,[t(r,{onClick:e[3]||(e[3]=s=>T.value=!1),size:"large"},{default:a(()=>[...e[42]||(e[42]=[v("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Ue,loading:h.value,size:"large"},{default:a(()=>[...e[43]||(e[43]=[v(" 保存更改 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(re,{model:I.value,"label-width":"90px",class:"order-form"},{default:a(()=>[t(C,{label:"选择客户",required:""},{default:a(()=>[t(P,{modelValue:I.value.customerId,"onUpdate:modelValue":e[2]||(e[2]=s=>I.value.customerId=s),placeholder:"请选择客户",size:"large",filterable:"",style:{width:"100%"}},{default:a(()=>[(c(!0),E(Z,null,ee(pe.value,s=>(c(),k(g,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(N,{"content-position":"left"},{default:a(()=>[...e[38]||(e[38]=[v("订单商品",-1)])]),_:1}),l("div",Ft,[(c(!0),E(Z,null,ee(I.value.items,(s,_)=>(c(),E("div",{key:_,class:"item-form-card"},[l("div",Rt,[l("span",qt,"商品 "+u(_+1),1),I.value.items.length>1?(c(),k(r,{key:0,type:"danger",size:"small",text:"",onClick:y=>Ne(_)},{default:a(()=>[t(d,null,{default:a(()=>[t(G)]),_:1}),e[39]||(e[39]=v(" 移除 ",-1))]),_:1},8,["onClick"])):V("",!0)]),t(C,{label:"选择产品",required:""},{default:a(()=>[t(P,{modelValue:s.productId,"onUpdate:modelValue":y=>s.productId=y,placeholder:"搜索并选择产品",filterable:"",style:{width:"100%"},onChange:y=>Ve(s)},{default:a(()=>[(c(!0),E(Z,null,ee(j.value,y=>(c(),k(g,{key:y.id,label:`${y.name} (库存: ${y.stock||0})`,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),t(A,{gutter:20},{default:a(()=>[t(f,{span:12},{default:a(()=>[t(C,{label:"数量",required:""},{default:a(()=>[t(H,{modelValue:s.quantity,"onUpdate:modelValue":y=>s.quantity=y,min:.01,precision:2,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(f,{span:12},{default:a(()=>[t(C,{label:"单价",required:""},{default:a(()=>[t(H,{modelValue:s.unitPrice,"onUpdate:modelValue":y=>s.unitPrice=y,precision:2,min:0,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l("div",Ot,[e[40]||(e[40]=l("span",{class:"subtotal-label"},"小计:",-1)),l("span",Mt,"¥"+u(((s.quantity||0)*(s.unitPrice||0)).toFixed(2)),1)])]))),128))]),t(r,{type:"primary",plain:"",onClick:Ae,class:"add-item-btn",size:"large"},{default:a(()=>[t(d,null,{default:a(()=>[t(J)]),_:1}),e[41]||(e[41]=v(" 添加更多商品 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(Q,{modelValue:q.value,"onUpdate:modelValue":e[8]||(e[8]=s=>q.value=s),title:"开具发票",width:"650px","close-on-click-modal":!1},{footer:a(()=>{var s;return[l("div",da,[t(r,{onClick:e[7]||(e[7]=_=>q.value=!1),size:"large"},{default:a(()=>[...e[54]||(e[54]=[v("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Le,loading:h.value,disabled:!((s=n.value.customer)!=null&&s.taxNumber),size:"large"},{default:a(()=>[h.value?V("",!0):(c(),k(d,{key:0},{default:a(()=>[t(xe)]),_:1})),e[55]||(e[55]=v(" 确认开票 ",-1))]),_:1},8,["loading","disabled"])])]}),default:a(()=>{var s;return[(s=n.value.customer)!=null&&s.taxNumber?(c(),E("div",$t,[l("div",Ht,[e[49]||(e[49]=l("h4",{class:"section-title"},"客户开票信息",-1)),t(A,{gutter:16,class:"invoice-info"},{default:a(()=>[t(f,{span:12},{default:a(()=>[l("div",jt,[e[44]||(e[44]=l("span",{class:"info-label"},"公司抬头:",-1)),l("span",Wt,u(n.value.customer.companyName||"-"),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",Yt,[e[45]||(e[45]=l("span",{class:"info-label"},"税号:",-1)),l("span",Kt,u(n.value.customer.taxNumber||"-"),1)])]),_:1}),t(f,{span:24},{default:a(()=>[l("div",Gt,[e[46]||(e[46]=l("span",{class:"info-label"},"公司地址:",-1)),l("span",Jt,u(n.value.customer.companyAddress||"-"),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",Qt,[e[47]||(e[47]=l("span",{class:"info-label"},"开户银行:",-1)),l("span",Xt,u(n.value.customer.bankName||"-"),1)])]),_:1}),t(f,{span:12},{default:a(()=>[l("div",Zt,[e[48]||(e[48]=l("span",{class:"info-label"},"银行账号:",-1)),l("span",ea,u(n.value.customer.bankAccount||"-"),1)])]),_:1})]),_:1})]),t(N),t(re,{model:D.value,"label-width":"90px"},{default:a(()=>[t(C,{label:"发票类型",required:""},{default:a(()=>[t(qe,{modelValue:D.value.invoiceType,"onUpdate:modelValue":e[5]||(e[5]=_=>D.value.invoiceType=_),size:"large"},{default:a(()=>[t(ye,{label:"NORMAL"},{default:a(()=>[...e[50]||(e[50]=[v("普通发票",-1)])]),_:1}),t(ye,{label:"SPECIAL"},{default:a(()=>[...e[51]||(e[51]=[v("专用发票",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"税率",required:""},{default:a(()=>[t(P,{modelValue:D.value.taxRate,"onUpdate:modelValue":e[6]||(e[6]=_=>D.value.taxRate=_),size:"large",style:{width:"200px"}},{default:a(()=>[t(g,{label:"13%",value:.13}),t(g,{label:"9%",value:.09}),t(g,{label:"6%",value:.06}),t(g,{label:"3%",value:.03})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(N),l("div",ta,[l("div",aa,[e[52]||(e[52]=l("span",{class:"calc-label"},"订单金额:",-1)),l("span",la,"¥"+u(z.value.toFixed(2)),1)]),l("div",sa,[l("span",oa,"税额 ("+u((D.value.taxRate*100).toFixed(0))+"%):",1),l("span",na,"¥"+u(le.value),1)]),t(N,{style:{margin:"12px 0"}}),l("div",ia,[e[53]||(e[53]=l("span",{class:"calc-label"},"价税合计:",-1)),l("span",ua,"¥"+u(me.value),1)])])])):(c(),k(Re,{key:0,title:"客户开票信息不完整",type:"warning",description:"请先到客户管理页面完善该客户的税号等开票信息",closable:!1,style:{"margin-bottom":"20px"}}))]}),_:1},8,["modelValue"]),t(Q,{modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=s=>O.value=s),title:"发票预览",width:"900px","close-on-click-modal":!1},{footer:a(()=>[l("div",pa,[t(r,{onClick:e[9]||(e[9]=s=>O.value=!1),size:"large"},{default:a(()=>[...e[57]||(e[57]=[v("关闭",-1)])]),_:1}),t(r,{type:"primary",onClick:Te,loading:h.value,size:"large"},{default:a(()=>[h.value?V("",!0):(c(),k(d,{key:0},{default:a(()=>[t(xe)]),_:1})),e[58]||(e[58]=v(" 确认开具 ",-1))]),_:1},8,["loading"])])]),default:a(()=>[l("div",ra,[S.value?(c(),E("iframe",{key:0,src:S.value,style:{width:"100%",height:"700px",border:"1px solid #ddd","border-radius":"4px"}},null,8,ca)):(c(),E("div",va,[t(d,{style:{"font-size":"48px",color:"#909399"}},{default:a(()=>[t($)]),_:1}),e[56]||(e[56]=l("p",{style:{"margin-top":"20px",color:"#909399"}},"生成发票中...",-1))]))])]),_:1},8,["modelValue"]),t(Q,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=s=>F.value=s),title:"更新订单状态",width:"450px","close-on-click-modal":!1},{footer:a(()=>[l("div",fa,[t(r,{onClick:e[12]||(e[12]=s=>F.value=!1),size:"large"},{default:a(()=>[...e[59]||(e[59]=[v("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Se,loading:h.value,size:"large"},{default:a(()=>[...e[60]||(e[60]=[v(" 确认更新 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(re,{"label-width":"90px"},{default:a(()=>[t(C,{label:"当前状态"},{default:a(()=>[t(p,{type:ge(n.value.status),size:"large",effect:"dark"},{default:a(()=>[v(u(be(n.value.status)),1)]),_:1},8,["type"])]),_:1}),t(C,{label:"新状态",required:""},{default:a(()=>[t(P,{modelValue:R.value,"onUpdate:modelValue":e[11]||(e[11]=s=>R.value=s),placeholder:"请选择新状态",size:"large",style:{width:"100%"}},{default:a(()=>[t(g,{label:"已创建",value:"CREATED"}),t(g,{label:"未付款",value:"UNPAID"}),t(g,{label:"付款完成",value:"PAID"}),t(g,{label:"已开票",value:"INVOICED"}),t(g,{label:"已发货",value:"SHIPPED"}),t(g,{label:"已完成",value:"COMPLETED"}),t(g,{label:"已取消",value:"CANCELLED"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ba=Me(ma,[["__scopeId","data-v-45c23d91"]]);export{ba as default};
