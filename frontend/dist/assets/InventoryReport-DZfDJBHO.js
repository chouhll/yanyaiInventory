import{_ as G,r as g,K as A,o as H,d as C,h as e,w as t,i as r,L as P,E as p,v as J,j as f,F as W,B as X,x as U,m as a,s as Y,f as Z,t as u,e as D}from"./index-BTzqXMTB.js";const $={class:"inventory-report-page"},ee={class:"card-header"},te={key:0,class:"summary-section"},ne={__name:"InventoryReport",setup(le){const s=g(""),b=g([]),d=g([]),v=g(!1),y=g(!1),N=A(()=>d.value.reduce((i,o)=>i+(o.beginningAmount||0),0)),V=A(()=>d.value.reduce((i,o)=>i+(o.inboundAmount||0),0)),B=A(()=>d.value.reduce((i,o)=>i+(o.outboundCostAmount||0),0)),F=async()=>{try{b.value=await P.getPeriods(),b.value.length>0&&(s.value=b.value[0],await k())}catch{p.error("加载期间列表失败")}},k=async()=>{if(!s.value){p.warning("请选择期间");return}v.value=!0;try{d.value=await P.getReport(s.value),d.value.length===0&&p.info("该期间暂无报表数据，请先生成报表")}catch{p.error("加载报表失败")}finally{v.value=!1}},I=async()=>{if(!s.value){p.warning("请选择期间");return}y.value=!0;try{d.value=await P.generateReport(s.value),p.success("报表生成成功")}catch{p.error("生成报表失败")}finally{y.value=!1}},E=()=>{p.info("导出功能开发中...")},m=i=>i==null?"0.00":Number(i).toFixed(2),c=i=>i==null?"0.00":Number(i).toFixed(2);return H(()=>{F()}),(i,o)=>{const L=r("el-option"),M=r("el-select"),_=r("el-col"),j=r("DocumentAdd"),w=r("el-icon"),x=r("el-button"),K=r("Refresh"),Q=r("el-row"),R=r("el-card"),O=r("Download"),l=r("el-table-column"),S=r("el-tag"),T=r("el-table"),q=r("el-divider"),h=r("el-statistic"),z=J("loading");return f(),C("div",$,[e(R,{shadow:"hover",style:{"margin-bottom":"20px"}},{default:t(()=>[e(Q,{gutter:20,align:"middle"},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(M,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=n=>s.value=n),placeholder:"选择期间",style:{width:"100%"}},{default:t(()=>[(f(!0),C(W,null,X(b.value,n=>(f(),U(L,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(_,{span:16},{default:t(()=>[e(x,{type:"primary",onClick:I,loading:y.value},{default:t(()=>[e(w,null,{default:t(()=>[e(j)]),_:1}),o[1]||(o[1]=a(" 生成报表 ",-1))]),_:1},8,["loading"]),e(x,{onClick:k,loading:v.value},{default:t(()=>[e(w,null,{default:t(()=>[e(K)]),_:1}),o[2]||(o[2]=a(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(R,{shadow:"hover"},{header:t(()=>[D("div",ee,[D("span",null,"库存月报表 - "+u(s.value),1),e(x,{type:"success",onClick:E},{default:t(()=>[e(w,null,{default:t(()=>[e(O)]),_:1}),o[3]||(o[3]=a(" 导出报表 ",-1))]),_:1})])]),default:t(()=>[Y((f(),U(T,{data:d.value,style:{width:"100%"},border:"","header-cell-style":{background:"#f5f7fa",color:"#333"}},{default:t(()=>[e(l,{prop:"product.inventoryCode",label:"库存编码",width:"120",fixed:""}),e(l,{prop:"product.name",label:"存货名称",width:"150",fixed:""}),e(l,{prop:"product.specification",label:"规格型号",width:"120"}),e(l,{prop:"product.category",label:"存货分类",width:"100"}),e(l,{prop:"product.unit",label:"计量单位",width:"90"}),e(l,{label:"期初",align:"center"},{default:t(()=>[e(l,{prop:"beginningQuantity",label:"数量",width:"100",align:"right"},{default:t(({row:n})=>[a(u(m(n.beginningQuantity)),1)]),_:1}),e(l,{prop:"beginningUnitPrice",label:"单价",width:"100",align:"right"},{default:t(({row:n})=>[a(u(c(n.beginningUnitPrice)),1)]),_:1}),e(l,{prop:"beginningAmount",label:"金额",width:"120",align:"right"},{default:t(({row:n})=>[a(u(c(n.beginningAmount)),1)]),_:1})]),_:1}),e(l,{label:"入库",align:"center"},{default:t(()=>[e(l,{prop:"inboundQuantity",label:"数量",width:"100",align:"right"},{default:t(({row:n})=>[a(u(m(n.inboundQuantity)),1)]),_:1}),e(l,{prop:"inboundUnitPrice",label:"单价",width:"100",align:"right"},{default:t(({row:n})=>[a(u(c(n.inboundUnitPrice)),1)]),_:1}),e(l,{prop:"inboundAmount",label:"金额",width:"120",align:"right"},{default:t(({row:n})=>[a(u(c(n.inboundAmount)),1)]),_:1})]),_:1}),e(l,{label:"出库",align:"center"},{default:t(()=>[e(l,{prop:"outboundQuantity",label:"数量",width:"100",align:"right"},{default:t(({row:n})=>[a(u(m(n.outboundQuantity)),1)]),_:1}),e(l,{prop:"outboundCostUnitPrice",label:"成本单价",width:"110",align:"right"},{default:t(({row:n})=>[a(u(c(n.outboundCostUnitPrice)),1)]),_:1}),e(l,{prop:"outboundCostAmount",label:"成本金额",width:"120",align:"right"},{default:t(({row:n})=>[a(u(c(n.outboundCostAmount)),1)]),_:1})]),_:1}),e(l,{label:"结存",align:"center"},{default:t(()=>[e(l,{prop:"endingQuantity",label:"数量",width:"100",align:"right"},{default:t(({row:n})=>[e(S,{type:n.endingQuantity>0?"success":"info"},{default:t(()=>[a(u(m(n.endingQuantity)),1)]),_:2},1032,["type"])]),_:1}),e(l,{prop:"endingUnitPrice",label:"单价",width:"100",align:"right"},{default:t(({row:n})=>[a(u(c(n.endingUnitPrice)),1)]),_:1}),e(l,{prop:"endingAmount",label:"金额",width:"120",align:"right"},{default:t(({row:n})=>[a(u(c(n.endingAmount)),1)]),_:1})]),_:1})]),_:1},8,["data"])),[[z,v.value]]),d.value.length>0?(f(),C("div",te,[e(q,{"content-position":"left"},{default:t(()=>[...o[4]||(o[4]=[a("汇总统计",-1)])]),_:1}),e(Q,{gutter:20},{default:t(()=>[e(_,{span:6},{default:t(()=>[e(h,{title:"产品种类",value:d.value.length,suffix:"种"},null,8,["value"])]),_:1}),e(_,{span:6},{default:t(()=>[e(h,{title:"期初总额",value:N.value,precision:2,prefix:"¥"},null,8,["value"])]),_:1}),e(_,{span:6},{default:t(()=>[e(h,{title:"入库总额",value:V.value,precision:2,prefix:"¥"},null,8,["value"])]),_:1}),e(_,{span:6},{default:t(()=>[e(h,{title:"出库总额",value:B.value,precision:2,prefix:"¥"},null,8,["value"])]),_:1})]),_:1})])):Z("",!0)]),_:1})])}}},ae=G(ne,[["__scopeId","data-v-7aa73dd0"]]);export{ae as default};
