import{_ as p,d as n,e as t,f as h,F as y,B as _,s as f,Q as A,t as l,T as v,j as d,A as m,m as g}from"./index-CX8ur3in.js";const b={name:"CostAnalysis",data(){return{activeTab:"products",tabs:[{key:"products",label:"产品利润分析"},{key:"customers",label:"客户利润分析"},{key:"suppliers",label:"供应商成本分析"}],datePeriods:[{key:"today",label:"今天"},{key:"thisWeek",label:"本周"},{key:"thisMonth",label:"本月"},{key:"thisYear",label:"本年"},{key:"custom",label:"自定义"}],selectedPeriod:"thisMonth",customStartDate:"",customEndDate:"",dateRange:{startDate:null,endDate:null},loading:!1,productAnalysis:[],customerAnalysis:[],supplierAnalysis:[]}},computed:{productSummary(){if(this.productAnalysis.length===0)return{totalSales:0,totalCost:0,totalProfit:0,avgProfitRate:0};const o=this.productAnalysis.reduce((r,e)=>r+parseFloat(e.totalSales||0),0),s=this.productAnalysis.reduce((r,e)=>r+parseFloat(e.totalCost||0),0),u=o-s,c=o>0?u/o*100:0;return{totalSales:o,totalCost:s,totalProfit:u,avgProfitRate:c}},customerSummary(){if(this.customerAnalysis.length===0)return{totalSales:0,totalProfit:0,avgOrderValue:0};const o=this.customerAnalysis.reduce((e,a)=>e+parseFloat(a.totalSales||0),0),s=this.customerAnalysis.reduce((e,a)=>e+parseFloat(a.totalCost||0),0),u=o-s,c=this.customerAnalysis.reduce((e,a)=>e+a.orderCount,0),r=c>0?o/c:0;return{totalSales:o,totalProfit:u,avgOrderValue:r}},supplierSummary(){if(this.supplierAnalysis.length===0)return{totalPurchase:0,totalCount:0,avgPrice:0};const o=this.supplierAnalysis.reduce((c,r)=>c+parseFloat(r.totalPurchaseAmount||0),0),s=this.supplierAnalysis.reduce((c,r)=>c+r.purchaseCount,0),u=this.supplierAnalysis.reduce((c,r)=>c+parseFloat(r.averagePrice||0),0)/this.supplierAnalysis.length;return{totalPurchase:o,totalCount:s,avgPrice:u}}},mounted(){this.selectDatePeriod("thisMonth")},methods:{selectDatePeriod(o){this.selectedPeriod=o;const s=new Date;let u,c;switch(o){case"today":u=new Date(s.setHours(0,0,0,0)),c=new Date(s.setHours(23,59,59,999));break;case"thisWeek":const r=s.getDay(),e=s.getDate()-r+(r===0?-6:1);u=new Date(s.setDate(e)),u.setHours(0,0,0,0),c=new Date(u),c.setDate(u.getDate()+6),c.setHours(23,59,59,999);break;case"thisMonth":u=new Date(s.getFullYear(),s.getMonth(),1,0,0,0,0),c=new Date(s.getFullYear(),s.getMonth()+1,0,23,59,59,999);break;case"thisYear":u=new Date(s.getFullYear(),0,1,0,0,0,0),c=new Date(s.getFullYear(),11,31,23,59,59,999);break;case"custom":return}this.dateRange.startDate=u.toISOString(),this.dateRange.endDate=c.toISOString(),this.loadData()},async loadData(){var o,s;if(this.selectedPeriod==="custom"){if(!this.customStartDate||!this.customEndDate){alert("请选择日期范围");return}this.dateRange.startDate=new Date(this.customStartDate).toISOString(),this.dateRange.endDate=new Date(this.customEndDate).toISOString()}this.loading=!0;try{await Promise.all([this.loadProductAnalysis(),this.loadCustomerAnalysis(),this.loadSupplierAnalysis()])}catch(u){console.error("加载数据失败:",u),alert("加载数据失败: "+(((s=(o=u.response)==null?void 0:o.data)==null?void 0:s.message)||u.message))}finally{this.loading=!1}},async loadProductAnalysis(){const o=await v.get("/cost-analysis/products",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.productAnalysis=Array.isArray(o)?o:[]},async loadCustomerAnalysis(){const o=await v.get("/cost-analysis/customers",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.customerAnalysis=Array.isArray(o)?o:[]},async loadSupplierAnalysis(){const o=await v.get("/cost-analysis/suppliers",{params:{startDate:this.dateRange.startDate,endDate:this.dateRange.endDate}});this.supplierAnalysis=Array.isArray(o)?o:[]},formatAmount(o){return o?parseFloat(o).toFixed(2):"0.00"},formatPercent(o){return o?parseFloat(o).toFixed(2):"0.00"},getRateClass(o){const s=parseFloat(o);return s>=40?"excellent":s>=30?"good":s>=20?"average":"low"},getVolatilityClass(o){const s=parseFloat(o);return s<=10?"excellent":s<=20?"good":s<=30?"average":"low"}}},k={class:"cost-analysis"},D={class:"date-selector"},P={class:"date-buttons"},S=["onClick"],C={key:0,class:"custom-date-range"},R={class:"tabs"},w=["onClick"],F={key:0,class:"tab-content"},V={key:0,class:"loading"},O={key:1},T={class:"summary-cards"},x={class:"summary-card"},I={class:"card-value"},M={class:"summary-card"},E={class:"card-value cost"},N={class:"summary-card highlight"},Y={class:"card-value profit"},B={class:"summary-card"},H={class:"card-value rate"},Q={key:0,class:"no-data"},W={key:1,class:"analysis-table"},U={class:"product-name"},j={class:"amount"},z={class:"number"},L={class:"amount cost-text"},q={class:"amount profit-text"},G={class:"number"},J={class:"amount"},K={key:1,class:"tab-content"},X={key:0,class:"loading"},Z={key:1},$={class:"summary-cards"},tt={class:"summary-card"},st={class:"card-value"},at={class:"summary-card"},et={class:"card-value"},lt={class:"summary-card highlight"},rt={class:"card-value profit"},ot={class:"summary-card"},nt={class:"card-value"},dt={key:0,class:"no-data"},ut={key:1,class:"analysis-table"},ct={class:"customer-name"},it={class:"amount"},mt={class:"amount cost-text"},ht={class:"amount profit-text"},yt={class:"number"},_t={class:"amount"},vt={class:"number value-score"},gt={key:2,class:"tab-content"},ft={key:0,class:"loading"},At={key:1},pt={class:"summary-cards"},bt={class:"summary-card"},kt={class:"card-value"},Dt={class:"summary-card"},Pt={class:"card-value"},St={class:"summary-card"},Ct={class:"card-value"},Rt={class:"summary-card"},wt={class:"card-value"},Ft={key:0,class:"no-data"},Vt={key:1,class:"analysis-table"},Ot={class:"supplier-name"},Tt={class:"amount"},xt={class:"number"},It={class:"number"},Mt={class:"amount"},Et={class:"amount"},Nt={class:"amount"},Yt={class:"amount"};function Bt(o,s,u,c,r,e){return d(),n("div",k,[s[19]||(s[19]=t("h1",null,"成本分析",-1)),t("div",D,[t("div",P,[(d(!0),n(y,null,_(r.datePeriods,a=>(d(),n("button",{key:a.key,onClick:i=>e.selectDatePeriod(a.key),class:m(["date-btn",{active:r.selectedPeriod===a.key}])},l(a.label),11,S))),128))]),r.selectedPeriod==="custom"?(d(),n("div",C,[f(t("input",{type:"datetime-local","onUpdate:modelValue":s[0]||(s[0]=a=>r.customStartDate=a)},null,512),[[A,r.customStartDate]]),s[3]||(s[3]=t("span",null,"至",-1)),f(t("input",{type:"datetime-local","onUpdate:modelValue":s[1]||(s[1]=a=>r.customEndDate=a)},null,512),[[A,r.customEndDate]]),t("button",{onClick:s[2]||(s[2]=(...a)=>e.loadData&&e.loadData(...a)),class:"refresh-btn"},"查询")])):h("",!0)]),t("div",R,[(d(!0),n(y,null,_(r.tabs,a=>(d(),n("div",{key:a.key,onClick:i=>r.activeTab=a.key,class:m(["tab",{active:r.activeTab===a.key}])},l(a.label),11,w))),128))]),r.activeTab==="products"?(d(),n("div",F,[r.loading?(d(),n("div",V,"加载中...")):(d(),n("div",O,[t("div",T,[t("div",x,[s[4]||(s[4]=t("div",{class:"card-label"},"总销售额",-1)),t("div",I,"¥"+l(e.formatAmount(e.productSummary.totalSales)),1)]),t("div",M,[s[5]||(s[5]=t("div",{class:"card-label"},"总成本",-1)),t("div",E,"¥"+l(e.formatAmount(e.productSummary.totalCost)),1)]),t("div",N,[s[6]||(s[6]=t("div",{class:"card-label"},"总毛利润",-1)),t("div",Y,"¥"+l(e.formatAmount(e.productSummary.totalProfit)),1)]),t("div",B,[s[7]||(s[7]=t("div",{class:"card-label"},"平均毛利率",-1)),t("div",H,l(e.formatPercent(e.productSummary.avgProfitRate))+"%",1)])]),r.productAnalysis.length===0?(d(),n("div",Q,"暂无产品分析数据")):(d(),n("table",W,[s[8]||(s[8]=t("thead",null,[t("tr",null,[t("th",null,"产品编码"),t("th",null,"产品名称"),t("th",null,"规格"),t("th",null,"销售额"),t("th",null,"销售数量"),t("th",null,"成本"),t("th",null,"毛利润"),t("th",null,"毛利率"),t("th",null,"订单次数"),t("th",null,"平均单价")])],-1)),t("tbody",null,[(d(!0),n(y,null,_(r.productAnalysis,(a,i)=>(d(),n("tr",{key:a.productId},[t("td",null,[i<3?(d(),n("span",{key:0,class:m(["rank-badge","rank-"+(i+1)])},l(i+1),3)):h("",!0),g(" "+l(a.productCode),1)]),t("td",U,l(a.productName),1),t("td",null,l(a.specification||"-"),1),t("td",j,"¥"+l(e.formatAmount(a.totalSales)),1),t("td",z,l(e.formatAmount(a.totalQuantity)),1),t("td",L,"¥"+l(e.formatAmount(a.totalCost)),1),t("td",q,"¥"+l(e.formatAmount(a.grossProfit)),1),t("td",{class:m(["rate-cell",e.getRateClass(a.grossProfitRate)])},l(e.formatPercent(a.grossProfitRate))+"% ",3),t("td",G,l(a.orderCount),1),t("td",J,"¥"+l(e.formatAmount(a.averagePrice)),1)]))),128))])]))]))])):h("",!0),r.activeTab==="customers"?(d(),n("div",K,[r.loading?(d(),n("div",X,"加载中...")):(d(),n("div",Z,[t("div",$,[t("div",tt,[s[9]||(s[9]=t("div",{class:"card-label"},"客户总数",-1)),t("div",st,l(r.customerAnalysis.length),1)]),t("div",at,[s[10]||(s[10]=t("div",{class:"card-label"},"总销售额",-1)),t("div",et,"¥"+l(e.formatAmount(e.customerSummary.totalSales)),1)]),t("div",lt,[s[11]||(s[11]=t("div",{class:"card-label"},"总毛利润",-1)),t("div",rt,"¥"+l(e.formatAmount(e.customerSummary.totalProfit)),1)]),t("div",ot,[s[12]||(s[12]=t("div",{class:"card-label"},"平均订单价值",-1)),t("div",nt,"¥"+l(e.formatAmount(e.customerSummary.avgOrderValue)),1)])]),r.customerAnalysis.length===0?(d(),n("div",dt,"暂无客户分析数据")):(d(),n("table",ut,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"客户名称"),t("th",null,"销售额"),t("th",null,"成本"),t("th",null,"毛利润"),t("th",null,"毛利率"),t("th",null,"订单次数"),t("th",null,"平均订单价值"),t("th",null,"客户价值评分")])],-1)),t("tbody",null,[(d(!0),n(y,null,_(r.customerAnalysis,(a,i)=>(d(),n("tr",{key:a.customerId},[t("td",ct,[i<3?(d(),n("span",{key:0,class:m(["rank-badge","rank-"+(i+1)])},l(i+1),3)):h("",!0),g(" "+l(a.customerName),1)]),t("td",it,"¥"+l(e.formatAmount(a.totalSales)),1),t("td",mt,"¥"+l(e.formatAmount(a.totalCost)),1),t("td",ht,"¥"+l(e.formatAmount(a.grossProfit)),1),t("td",{class:m(["rate-cell",e.getRateClass(a.grossProfitRate)])},l(e.formatPercent(a.grossProfitRate))+"% ",3),t("td",yt,l(a.orderCount),1),t("td",_t,"¥"+l(e.formatAmount(a.averageOrderValue)),1),t("td",vt,l(e.formatAmount(a.valueScore)),1)]))),128))])]))]))])):h("",!0),r.activeTab==="suppliers"?(d(),n("div",gt,[r.loading?(d(),n("div",ft,"加载中...")):(d(),n("div",At,[t("div",pt,[t("div",bt,[s[14]||(s[14]=t("div",{class:"card-label"},"供应商总数",-1)),t("div",kt,l(r.supplierAnalysis.length),1)]),t("div",Dt,[s[15]||(s[15]=t("div",{class:"card-label"},"总采购额",-1)),t("div",Pt,"¥"+l(e.formatAmount(e.supplierSummary.totalPurchase)),1)]),t("div",St,[s[16]||(s[16]=t("div",{class:"card-label"},"采购次数",-1)),t("div",Ct,l(e.supplierSummary.totalCount),1)]),t("div",Rt,[s[17]||(s[17]=t("div",{class:"card-label"},"平均单价",-1)),t("div",wt,"¥"+l(e.formatAmount(e.supplierSummary.avgPrice)),1)])]),r.supplierAnalysis.length===0?(d(),n("div",Ft,"暂无供应商分析数据")):(d(),n("table",Vt,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",null,"供应商名称"),t("th",null,"信用等级"),t("th",null,"采购总额"),t("th",null,"采购数量"),t("th",null,"采购次数"),t("th",null,"平均单价"),t("th",null,"最低价"),t("th",null,"最高价"),t("th",null,"价格波动率"),t("th",null,"平均采购额")])],-1)),t("tbody",null,[(d(!0),n(y,null,_(r.supplierAnalysis,(a,i)=>(d(),n("tr",{key:a.supplierId},[t("td",Ot,[i<3?(d(),n("span",{key:0,class:m(["rank-badge","rank-"+(i+1)])},l(i+1),3)):h("",!0),g(" "+l(a.supplierName),1)]),t("td",null,[t("span",{class:m(["credit-badge","credit-"+a.creditRating])},l(a.creditRating||"-"),3)]),t("td",Tt,"¥"+l(e.formatAmount(a.totalPurchaseAmount)),1),t("td",xt,l(e.formatAmount(a.totalQuantity)),1),t("td",It,l(a.purchaseCount),1),t("td",Mt,"¥"+l(e.formatAmount(a.averagePrice)),1),t("td",Et,"¥"+l(e.formatAmount(a.minPrice)),1),t("td",Nt,"¥"+l(e.formatAmount(a.maxPrice)),1),t("td",{class:m(["rate-cell",e.getVolatilityClass(a.priceVolatility)])},l(e.formatPercent(a.priceVolatility))+"% ",3),t("td",Yt,"¥"+l(e.formatAmount(a.averagePurchaseAmount)),1)]))),128))])]))]))])):h("",!0)])}const Qt=p(b,[["render",Bt],["__scopeId","data-v-1d5c1823"]]);export{Qt as default};
