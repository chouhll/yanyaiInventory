import{_ as h,d as l,e as t,f as u,F as y,B as v,R as b,s as f,S as g,Q as w,t as r,A as m,T as p,j as a}from"./index-CX8ur3in.js";const k={name:"Reconciliation",data(){return{reconciliations:[],suppliers:[],customers:[],loading:!1,filterType:"ALL",reconciliationTypes:[{key:"ALL",label:"全部"},{key:"SUPPLIER",label:"供应商对账"},{key:"CUSTOMER",label:"客户对账"}],showCreateDialog:!1,showDetailsDialog:!1,selectedReconciliation:null,newReconciliation:{type:"SUPPLIER",supplierId:"",customerId:"",periodStart:"",periodEnd:""}}},computed:{filteredReconciliations(){return this.filterType==="ALL"?this.reconciliations:this.reconciliations.filter(s=>s.type===this.filterType)}},mounted(){this.loadReconciliations(),this.loadSuppliers(),this.loadCustomers()},methods:{async loadReconciliations(){var s,e;this.loading=!0;try{const c=await p.get("/reconciliations");this.reconciliations=Array.isArray(c)?c:[]}catch(c){console.error("加载对账单失败:",c),alert("加载对账单失败: "+(((e=(s=c.response)==null?void 0:s.data)==null?void 0:e.message)||c.message))}finally{this.loading=!1}},async loadSuppliers(){try{const s=await p.get("/suppliers");this.suppliers=Array.isArray(s)?s:[]}catch(s){console.error("加载供应商失败:",s)}},async loadCustomers(){try{const s=await p.get("/customers");this.customers=Array.isArray(s)?s:[]}catch(s){console.error("加载客户失败:",s)}},async createReconciliation(){var e,c;if(!this.newReconciliation.periodStart||!this.newReconciliation.periodEnd){alert("请选择对账期间");return}const s={periodStart:this.newReconciliation.periodStart,periodEnd:this.newReconciliation.periodEnd};try{const d=this.newReconciliation.type==="SUPPLIER"?`/reconciliations/supplier?supplierId=${this.newReconciliation.supplierId}`:`/reconciliations/customer?customerId=${this.newReconciliation.customerId}`;await p.post(d,null,{params:s}),alert("对账单创建成功"),this.showCreateDialog=!1,this.resetNewReconciliation(),this.loadReconciliations()}catch(d){console.error("创建对账单失败:",d),alert("创建对账单失败: "+(((c=(e=d.response)==null?void 0:e.data)==null?void 0:c.message)||d.message))}},async submitReconciliation(s){var e,c;if(confirm("确定要提交此对账单吗？"))try{await p.post(`/reconciliations/${s}/submit`),alert("对账单已提交"),this.loadReconciliations()}catch(d){console.error("提交对账单失败:",d),alert("提交对账单失败: "+(((c=(e=d.response)==null?void 0:e.data)==null?void 0:c.message)||d.message))}},async confirmReconciliation(s){var c,d;const e=prompt("请输入确认人姓名:");if(e)try{await p.post(`/reconciliations/${s}/confirm`,{confirmedBy:e}),alert("对账单已确认"),this.loadReconciliations()}catch(o){console.error("确认对账单失败:",o),alert("确认对账单失败: "+(((d=(c=o.response)==null?void 0:c.data)==null?void 0:d.message)||o.message))}},async deleteReconciliation(s){var e,c;if(confirm("确定要删除此对账单吗？"))try{await p.delete(`/reconciliations/${s}`),alert("对账单已删除"),this.loadReconciliations()}catch(d){console.error("删除对账单失败:",d),alert("删除对账单失败: "+(((c=(e=d.response)==null?void 0:e.data)==null?void 0:c.message)||d.message))}},viewDetails(s){this.selectedReconciliation=s,this.showDetailsDialog=!0},resetNewReconciliation(){this.newReconciliation={type:"SUPPLIER",supplierId:"",customerId:"",periodStart:"",periodEnd:""}},getPartyName(s){return s.supplier?s.supplier.name:s.customer?s.customer.name:"-"},formatAmount(s){return s?parseFloat(s).toFixed(2):"0.00"},formatDate(s){return s||"-"},formatPeriod(s,e){return`${s} ~ ${e}`},getStatusLabel(s){return{DRAFT:"草稿",SUBMITTED:"已提交",CONFIRMED:"已确认",DISPUTED:"有异议",RESOLVED:"已解决"}[s]||s},getStatusClass(s){return{DRAFT:"draft",SUBMITTED:"submitted",CONFIRMED:"confirmed",DISPUTED:"disputed",RESOLVED:"resolved"}[s]||""},getDifferenceClass(s){const e=parseFloat(s||0);return e===0?"zero":e>0?"positive":"negative"}}},D={class:"reconciliation"},C={class:"action-bar"},S={class:"filter-buttons"},_=["onClick"],E={class:"reconciliation-list"},A={key:0,class:"loading"},I={key:1,class:"no-data"},T={key:2,class:"reconciliation-table"},P={class:"rec-number"},L={class:"name"},U={class:"amount"},M={class:"amount"},F={class:"actions"},N=["onClick"],V=["onClick"],B=["onClick"],O=["onClick"],x={class:"dialog"},z={class:"form-group"},j={key:0,class:"form-group"},Q=["value"],q={key:1,class:"form-group"},G=["value"],H={class:"form-group"},J={class:"form-group"},K={class:"dialog-actions"},W={class:"dialog large"},X={key:0,class:"details-content"},Y={class:"detail-row"},Z={class:"value"},$={class:"detail-row"},ee={class:"detail-row"},te={class:"value"},ie={class:"detail-row"},se={class:"value"},oe={class:"detail-row"},ne={class:"value"},le={class:"detail-row"},ae={key:0,class:"detail-row"},re={class:"details-text"},ce={key:1,class:"detail-row"},de={class:"value"},ue={class:"dialog-actions"};function pe(s,e,c,d,o,n){return a(),l("div",D,[e[31]||(e[31]=t("h1",null,"对账管理",-1)),t("div",C,[t("button",{onClick:e[0]||(e[0]=i=>o.showCreateDialog=!0),class:"create-btn"},[...e[11]||(e[11]=[t("span",null,"+ 创建对账单",-1)])]),t("div",S,[(a(!0),l(y,null,v(o.reconciliationTypes,i=>(a(),l("button",{key:i.key,onClick:R=>o.filterType=i.key,class:m(["filter-btn",{active:o.filterType===i.key}])},r(i.label),11,_))),128))])]),t("div",E,[o.loading?(a(),l("div",A,"加载中...")):n.filteredReconciliations.length===0?(a(),l("div",I,"暂无对账单")):(a(),l("table",T,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"对账单号"),t("th",null,"类型"),t("th",null,"对象"),t("th",null,"对账期间"),t("th",null,"我方金额"),t("th",null,"对方金额"),t("th",null,"差异金额"),t("th",null,"状态"),t("th",null,"对账日期"),t("th",null,"操作")])],-1)),t("tbody",null,[(a(!0),l(y,null,v(n.filteredReconciliations,i=>(a(),l("tr",{key:i.id},[t("td",P,r(i.reconciliationNumber),1),t("td",null,[t("span",{class:m(["type-badge",i.type.toLowerCase()])},r(i.type==="SUPPLIER"?"供应商":"客户"),3)]),t("td",L,r(n.getPartyName(i)),1),t("td",null,r(n.formatPeriod(i.periodStart,i.periodEnd)),1),t("td",U,"¥"+r(n.formatAmount(i.ourAmount)),1),t("td",M,"¥"+r(n.formatAmount(i.theirAmount)),1),t("td",{class:m(["amount",n.getDifferenceClass(i.differenceAmount)])}," ¥"+r(n.formatAmount(i.differenceAmount)),3),t("td",null,[t("span",{class:m(["status-badge",n.getStatusClass(i.status)])},r(n.getStatusLabel(i.status)),3)]),t("td",null,r(n.formatDate(i.reconciliationDate)),1),t("td",F,[t("button",{onClick:R=>n.viewDetails(i),class:"action-btn view"},"查看",8,N),i.status==="DRAFT"?(a(),l("button",{key:0,onClick:R=>n.submitReconciliation(i.id),class:"action-btn submit"}," 提交 ",8,V)):u("",!0),i.status==="SUBMITTED"?(a(),l("button",{key:1,onClick:R=>n.confirmReconciliation(i.id),class:"action-btn confirm"}," 确认 ",8,B)):u("",!0),i.status!=="CONFIRMED"?(a(),l("button",{key:2,onClick:R=>n.deleteReconciliation(i.id),class:"action-btn delete"}," 删除 ",8,O)):u("",!0)])]))),128))])]))]),o.showCreateDialog?(a(),l("div",{key:0,class:"dialog-overlay",onClick:e[8]||(e[8]=b(i=>o.showCreateDialog=!1,["self"]))},[t("div",x,[e[21]||(e[21]=t("h2",null,"创建对账单",-1)),t("div",z,[e[14]||(e[14]=t("label",null,"对账类型",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.newReconciliation.type=i)},[...e[13]||(e[13]=[t("option",{value:"SUPPLIER"},"供应商对账",-1),t("option",{value:"CUSTOMER"},"客户对账",-1)])],512),[[g,o.newReconciliation.type]])]),o.newReconciliation.type==="SUPPLIER"?(a(),l("div",j,[e[16]||(e[16]=t("label",null,"选择供应商",-1)),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.newReconciliation.supplierId=i)},[e[15]||(e[15]=t("option",{value:""},"请选择供应商",-1)),(a(!0),l(y,null,v(o.suppliers,i=>(a(),l("option",{key:i.id,value:i.id},r(i.name),9,Q))),128))],512),[[g,o.newReconciliation.supplierId]])])):u("",!0),o.newReconciliation.type==="CUSTOMER"?(a(),l("div",q,[e[18]||(e[18]=t("label",null,"选择客户",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>o.newReconciliation.customerId=i)},[e[17]||(e[17]=t("option",{value:""},"请选择客户",-1)),(a(!0),l(y,null,v(o.customers,i=>(a(),l("option",{key:i.id,value:i.id},r(i.name),9,G))),128))],512),[[g,o.newReconciliation.customerId]])])):u("",!0),t("div",H,[e[19]||(e[19]=t("label",null,"对账期间开始",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=i=>o.newReconciliation.periodStart=i)},null,512),[[w,o.newReconciliation.periodStart]])]),t("div",J,[e[20]||(e[20]=t("label",null,"对账期间结束",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=i=>o.newReconciliation.periodEnd=i)},null,512),[[w,o.newReconciliation.periodEnd]])]),t("div",K,[t("button",{onClick:e[6]||(e[6]=(...i)=>n.createReconciliation&&n.createReconciliation(...i)),class:"btn-primary"},"创建"),t("button",{onClick:e[7]||(e[7]=i=>o.showCreateDialog=!1),class:"btn-secondary"},"取消")])])])):u("",!0),o.showDetailsDialog?(a(),l("div",{key:1,class:"dialog-overlay",onClick:e[10]||(e[10]=b(i=>o.showDetailsDialog=!1,["self"]))},[t("div",W,[e[30]||(e[30]=t("h2",null,"对账单详情",-1)),o.selectedReconciliation?(a(),l("div",X,[t("div",Y,[e[22]||(e[22]=t("span",{class:"label"},"对账单号:",-1)),t("span",Z,r(o.selectedReconciliation.reconciliationNumber),1)]),t("div",$,[e[23]||(e[23]=t("span",{class:"label"},"状态:",-1)),t("span",{class:m(["status-badge",n.getStatusClass(o.selectedReconciliation.status)])},r(n.getStatusLabel(o.selectedReconciliation.status)),3)]),t("div",ee,[e[24]||(e[24]=t("span",{class:"label"},"对账期间:",-1)),t("span",te,r(n.formatPeriod(o.selectedReconciliation.periodStart,o.selectedReconciliation.periodEnd)),1)]),t("div",ie,[e[25]||(e[25]=t("span",{class:"label"},"我方金额:",-1)),t("span",se,"¥"+r(n.formatAmount(o.selectedReconciliation.ourAmount)),1)]),t("div",oe,[e[26]||(e[26]=t("span",{class:"label"},"对方金额:",-1)),t("span",ne,"¥"+r(n.formatAmount(o.selectedReconciliation.theirAmount)),1)]),t("div",le,[e[27]||(e[27]=t("span",{class:"label"},"差异金额:",-1)),t("span",{class:m(["value",n.getDifferenceClass(o.selectedReconciliation.differenceAmount)])}," ¥"+r(n.formatAmount(o.selectedReconciliation.differenceAmount)),3)]),o.selectedReconciliation.details?(a(),l("div",ae,[e[28]||(e[28]=t("span",{class:"label"},"对账明细:",-1)),t("pre",re,r(o.selectedReconciliation.details),1)])):u("",!0),o.selectedReconciliation.differenceRemark?(a(),l("div",ce,[e[29]||(e[29]=t("span",{class:"label"},"差异说明:",-1)),t("span",de,r(o.selectedReconciliation.differenceRemark),1)])):u("",!0)])):u("",!0),t("div",ue,[t("button",{onClick:e[9]||(e[9]=i=>o.showDetailsDialog=!1),class:"btn-secondary"},"关闭")])])])):u("",!0)])}const fe=h(k,[["render",pe],["__scopeId","data-v-b4233108"]]);export{fe as default};
